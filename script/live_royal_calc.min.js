/*!
 * THE IDOLM@STER CINDERELLA GIRLS Exertion Value Calculator for Idol Live Royal 
 * Copyright (c) 2013 Mutsuki Kimuraya (http://www4018uf.sakura.ne.jp/)
 * Released under the MIT license
 * http://opensource.org/licenses/mit-license.php
 */
var Common=function(){function a(){}return a.load_idol_list=function(a,b,c){var d=this;void 0===c&&(c=[]);var e=this.IDOL_LIST_KEY_BASE;-1==a&&-1==b?e+="_all":(-1!=a&&(e+="_t"+a),-1!=b&&(e+="_r"+b));var f=this.cache_data[e],g=jQuery.Deferred();if(null!=f)g.resolve(JSON.parse(f));else{var h={};-1!=a&&(h.type=a),-1!=b&&(h.rarity=b),c.length>0&&(h.fields=c.join(" ")),jQuery.post(this.IDOL_DATA_API_URL,h,function(a){d.cache_data[e]=JSON.stringify(a),g.resolve(a)},"json")}return g.promise()},a.load_skill_list=function(){var a=this,b=this.SKILL_LIST_KEY,c=this.cache_data[b],d=jQuery.Deferred();return null!=c?d.resolve(JSON.parse(c)):jQuery.post(this.SKILL_DATA_API_URL,function(c){a.cache_data[b]=JSON.stringify(c),d.resolve(c)},"json"),d.promise()},a.get_compress_data=function(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c),e=parseInt(d.toString(),10);b.push(e)}for(var f=new Zlib.Deflate(b).compress(),g="",c=0;c<f.length;c++)g+=("0"+f[c].toString(16)).slice(-2);return g},a.get_decompress_data=function(a){for(var b=[],c=0;c<a.length;c+=2)b.push(parseInt(a.substr(c,2),16));for(var d=new Zlib.Inflate(b).decompress(),e="",c=0;c<d.length;c++)e+=String.fromCharCode(d[c]);return e},a.get_param_list=function(){var a={},b=location.href.indexOf("?");if(b>-1)for(var c=location.href.slice(b+1),d=c.split("&"),e=0;e<d.length;e++){var f=d[e].split("=");f[1]&&(a[f[0]]=f[1])}return a},a.get_page_url=function(){var a=location.href,b=a.indexOf("?");return b>-1&&(a=a.slice(0,b)),a},a.get_qrcode_url=function(a,b){void 0===b&&(b=150);var c=[];return c.push("chs="+b+"x"+b),c.push("cht=qr"),c.push("chl="+a),this.GOOGLE_CHART_API_URL+"?"+c.join("&")},a.to_int=function(a){return a.match(/^[-+]?[0-9]+$/)||(a="0"),parseInt(a,10)},a.is_smartphone=function(){return null!=navigator.userAgent.match(/(Android|iPhone|iPad|Mobile)/g)},a.IDOL_DATA_API_URL="http://www4018uf.sakura.ne.jp/imas_cg/api/idol/list/",a.IDOL_LIST_KEY_BASE="imas_cg_idol_list",a.SKILL_DATA_API_URL="http://www4018uf.sakura.ne.jp/imas_cg/api/skill/list/",a.SKILL_LIST_KEY="imas_cg_skill_list",a.GOOGLE_CHART_API_URL="http://chart.apis.google.com/chart",a.cache_data={},a}(),UserIdol=function(){function a(a){this.id="0",this.type="0",this.rarity="0",this.cost="0",this.offense="0",this.defense="0",this.event_power="1",this.offense_skill="0",this.defense_skill="0",this.skill_id="0",this.skill_level="10",this.skill_name="無し",this.is_festival=!1,this.is_survival=!1,this.use_tour_skill=a,this.enable_skill=!1,this.actual_offense=0,this.actual_defense=0,this.style="numeric",this.idol_data_list=[],this.skill_data_list=[],this.set_idol_list(),this.set_skill_list(),ko.track(this)}return a.prototype.display_offense=function(){return Math.ceil(this.actual_offense)},a.prototype.display_defense=function(){return Math.ceil(this.actual_defense)},a.prototype.status=function(){return parseInt(this.offense)+parseInt(this.defense)},a.prototype.offense_per_cost=function(){return this.calc_cost_ratio(parseInt(this.offense))},a.prototype.defense_per_cost=function(){return this.calc_cost_ratio(parseInt(this.defense))},a.prototype.status_per_cost=function(){return this.calc_cost_ratio(this.status())},a.prototype.select_idol_list=function(){return this.idol_data_list},a.prototype.select_skill_list=function(){return this.skill_data_list},a.prototype.get_cost=function(){var b=parseInt(this.cost);return this.is_festival&&b==a.TRAINER_COST&&(b=5),b},a.prototype.calc_cost_ratio=function(a){var b=parseInt(this.cost),c=0;return b>0&&(c=Math.round(a/b*100)/100),c},a.prototype.get_cost_corrected_status=function(a,b,c){if(b>c){var d=c/b;this.is_survival?a=Math.ceil(a*d):(d=Math.ceil(10*d)/10,a=Math.ceil(a*d))}return a},a.prototype.set_idol_list=function(){var a=this,b=jQuery.Deferred(),c=parseInt(this.type),d=parseInt(this.rarity);return jQuery.when(this.load_idol_list(c,d)).done(function(c){a.set_select_idol_list(c),a.id="0",a.cost="0",a.offense="0",a.defense="0",a.offense_skill="0",a.defense_skill="0",a.skill_level="10",a.set_skill_info(null),b.resolve()}),b.promise()},a.prototype.set_select_idol_list=function(a){var b=[];b.push({id:"0",name:"-"});for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b.push({id:d.idol_id,name:d.name})}this.idol_data_list=b},a.prototype.set_skill_list=function(){var a=this,b=jQuery.Deferred();return jQuery.when(Common.load_skill_list()).done(function(c){var d=[];d.push({id:"0",name:"-"});for(var e in c)if(c.hasOwnProperty(e)){var f=c[e];d.push({id:f.skill_id,name:f.comment})}a.skill_data_list=d,b.resolve()}),b.promise()},a.prototype.change_idol=function(){var a=this,b=parseInt(this.type),c=parseInt(this.rarity),d=parseInt(this.id);this.offense_skill="0",this.defense_skill="0",isNaN(d)||0==d?(this.cost="0",this.offense="0",this.defense="0",this.set_skill_info(null)):jQuery.when(this.load_idol_list(b,c)).done(function(b){var c=b[a.id];a.cost=c.cost,a.offense=c.max_offense,a.defense=c.max_defense,a.set_skill_info(c)})},a.prototype.set_skill_info=function(a){var b="0",c="無し";null!=a&&(b=a.skill_id,this.use_tour_skill&&(b=a.live_tour_skill_id),void 0!=a.skill_name&&""!=a.skill_name&&(c=a.skill_name)),this.skill_name=c,this.skill_id=b},a.prototype.get_setting=function(){var a={};return a.type=this.type,a.rarity=this.rarity,a.id=this.id,a.cost=this.cost,a.offense=this.offense,a.defense=this.defense,a.event_power=this.event_power,a.offense_skill=this.offense_skill,a.defense_skill=this.defense_skill,a.skill_id=this.skill_id,a.skill_level=this.skill_level,a},a.prototype.set_setting=function(a){var b=this;this.type=a.type,this.rarity=a.rarity,jQuery.when(this.load_idol_list(parseInt(a.type),parseInt(a.rarity))).done(function(c){b.set_select_idol_list(c),b.id=a.id,null!=a.cost&&(b.cost=a.cost),b.offense=a.offense,b.defense=a.defense,b.event_power=a.event_power,b.offense_skill=a.offense_skill,b.defense_skill=a.defense_skill,b.set_skill_setting(c[a.id],a.skill_id,a.skill_level)})},a.prototype.set_skill_setting=function(a,b,c){var d=this;this.set_skill_info(a),this.skill_level=c,jQuery.when(Common.load_skill_list()).done(function(a){a.hasOwnProperty(b)&&(d.skill_id=b)})},a.prototype.get_type_ratio=function(b,c){var d=parseInt(this.type),e=0;return e+=d==b?a.PRODUCER_TYPE_COEFFICIENT:parseInt(c[d])/100},a.prototype.load_idol_list=function(a,b){var c=["type","rarity","name","cost","max_offense","max_defense","skill_name","skill_id","live_tour_skill_id"],d=jQuery.Deferred();return jQuery.when(Common.load_idol_list(a,b,c)).done(function(a){d.resolve(a)}),d.promise()},a.prototype.calculation=function(a,b,c,d,e,f,g,h,i){var j=0,k=0;if(!a||b>=1){var l=parseInt(this.offense),m=parseInt(this.defense),n=parseFloat(this.offense_skill),o=parseFloat(this.defense_skill);c?(j=this.calc_front_status(l,n,a,b,d,e,f,g,h,i),k=this.calc_front_status(m,o,a,b,d,e,f,g,h,i)):(j=this.calc_back_status(l,n,a,b),k=this.calc_back_status(m,o,a,b))}this.actual_offense=j,this.actual_defense=k},a.prototype.calculation_festivalS=function(a,b,c,d,e,f,g,h,i,j){var k=parseInt(this.offense),l=parseInt(this.defense),m=parseFloat(this.offense_skill),n=parseFloat(this.defense_skill),o=0,p=0;c?(o=this.calc_festivalS_front_status(k,m,a,b,d,e,f,g,h,i,j),p=this.calc_festivalS_front_status(l,n,a,b,d,e,f,g,h,i,-1)):(o=this.calc_back_status(k,m,a,b),p=this.calc_back_status(l,n,a,b)),this.actual_offense=o,this.actual_defense=p},a.prototype.calc_front_status=function(b,c,d,e,f,g,h,i,j,k){d&&(b=this.get_cost_corrected_status(b,this.get_cost(),e));for(var l=parseInt(this.type),m=0;m<h.length;m++)if(l==parseInt(h[m])){b=Math.ceil(b*(1+a.INSTITUTION_COEFFICIENT));break}var n=1+this.get_type_ratio(f,g)+(i+c)/100;return this.is_festival&&(n+=j/100,k&&(n+=a.HIGH_TENSION_BONUS_COEFFICIENT)),b=Math.ceil(b*n)},a.prototype.calc_back_status=function(b,c,d,e){var f=this.get_cost(),g=Math.ceil(b*a.BACK_MEMBER_COEFFICIENT),h=g;if(d&&(h=this.get_cost_corrected_status(h,f,e)),!this.is_festival||!d||e>=f){var i=c/100;h=Math.floor(h)+Math.ceil(g*i*10)/10}return h},a.prototype.calc_festivalS_front_status=function(b,c,d,e,f,g,h,i,j,k,l){d&&(b=this.get_cost_corrected_status(b,this.get_cost(),e));for(var m=parseInt(this.type),n=0;n<h.length;n++)if(m==parseInt(h[n])){b=Math.ceil(b*(1+a.INSTITUTION_COEFFICIENT));break}var o=1+this.get_type_ratio(f,g)+(c+j)/100;return b=Math.ceil(b*o),o=1+i/100,b*=o,o=1,m==l&&(o+=a.GROOVE_BONUS_COEFFICIENT),b=Math.round(b*o),o=1,k&&(o+=a.HIGH_TENSION_BONUS_COEFFICIENT),b=Math.round(b*o)},a.prototype.calculation_survival=function(a,b){this.is_survival=!0;var c=Math.floor(parseInt(this.offense)*parseFloat(this.event_power));a&&(c=this.get_cost_corrected_status(c,this.get_cost(),b)),this.actual_offense=c},a.prototype.calculation_live_tour=function(a,b,c,d,e,f,g){var h=parseInt(this.offense),i=parseInt(this.defense),j=parseFloat(this.offense_skill),k=parseFloat(this.defense_skill),l=0,m=0;a?(l=this.calc_live_tour_front_status(h,j,b,c,d,e,f,g),m=this.calc_live_tour_front_status(i,k,b,c,d,e,f,g)):(l=this.calc_live_tour_back_status(h,j,d),m=this.calc_live_tour_back_status(i,k,d)),this.actual_offense=l,this.actual_defense=m},a.prototype.calc_live_tour_status=function(b,c,d,e,f,g){var h=Math.floor(b*parseFloat(this.event_power)),i=1+this.get_type_ratio(d,e)+c/100;return h=Math.ceil(h*i),i=1,i+=f/100,h=Math.ceil(h*i),i=1,parseInt(this.type)==g&&(i+=a.COMPATIBILITY_BONUS_COEFFICIENT),h*=i},a.prototype.calc_live_tour_front_status=function(b,c,d,e,f,g,h,i){var j=Math.floor(b*parseFloat(this.event_power)),k=1+this.get_type_ratio(d,e)+(c+i)/100;return j=Math.ceil(j*k),k=1+f/100,j=Math.ceil(j*k),k=1+g/100,j=Math.ceil(j*k),k=1,parseInt(this.type)==h&&(k+=a.COMPATIBILITY_BONUS_COEFFICIENT),j*=k},a.prototype.calc_live_tour_back_status=function(b,c,d){var e=Math.floor(b*parseFloat(this.event_power));e=Math.ceil(e*a.BACK_MEMBER_COEFFICIENT);var f=1+(c+d)/100;return e=Math.ceil(e*f)},a.prototype.calc_live_tour_damage=function(b){var c=Math.floor(this.actual_offense);return c*=b?a.LIVE_TOUR_FULL_POWER_LIVE_COEFFICIENT:a.LIVE_TOUR_NORMAL_LIVE_COEFFICIENT,c/=5},a.prototype.calculation_dream_live_festival=function(a,b,c,d,e,f){var g=parseInt(this.offense),h=parseInt(this.defense),i=parseFloat(this.offense_skill),j=parseFloat(this.defense_skill),k=0,l=0;a?(k=this.calc_dream_live_festival_front_status(g,i,b,c,d,e,f),l=this.calc_dream_live_festival_front_status(h,j,b,c,d,e,f)):(k=this.calc_dream_live_festival_back_status(g,i,e),l=this.calc_dream_live_festival_back_status(h,j,e)),this.actual_offense=k,this.actual_defense=l},a.prototype.calc_dream_live_festival_front_status=function(b,c,d,e,f,g,h){var i=Math.floor(b*parseFloat(this.event_power)),j=1+g/100;return i=Math.floor(i*j),j=1+this.get_type_ratio(d,e)+(c+h)/100,i=Math.ceil(i*j),j=1,j+=Math.sqrt(a.DREAM_LIVE_FESTIVAL_COMBO_LEVEL_COEFFICIENT*f)/100,i=Math.ceil(i*j)},a.prototype.calc_dream_live_festival_back_status=function(b,c,d){var e=Math.floor(b*parseFloat(this.event_power));e=Math.ceil(e*a.BACK_MEMBER_COEFFICIENT);var f=1+d/100;return e=Math.floor(e*f),f=1+c/100,e=Math.ceil(e*f)},a.prototype.calc_dream_live_festival_damage=function(b){var c=Math.floor(this.actual_offense);return c*=b?a.DREAM_LIVE_FESTIVAL_FULL_POWER_LIVE_COEFFICIENT:a.DREAM_LIVE_FESTIVAL_NORMAL_LIVE_COEFFICIENT,c/=5},a.prototype.calculation_live_royal=function(a,b,c,d,e,f,g){var h=parseInt(this.offense),i=parseInt(this.defense),j=parseFloat(this.offense_skill),k=parseFloat(this.defense_skill),l=0,m=0;a?(l=this.calc_live_royal_front_status(h,j,b,c,d,e,f,g),m=this.calc_live_royal_front_status(i,k,b,c,d,e,f,g)):(l=this.calc_live_royal_back_status(h,j,b,e,f),m=this.calc_live_royal_back_status(i,k,b,e,f)),this.actual_offense=l,this.actual_defense=m},a.prototype.calc_live_royal_front_status=function(a,b,c,d,e,f,g,h){var i=1;c&&(i=parseFloat(this.event_power));var j=Math.ceil(a*i);j*=f,j*=g;var k=1+this.get_type_ratio(d,e)+(b+h)/100;return j*=k,j=Math.round(10*j)/10,Math.ceil(j)},a.prototype.calc_live_royal_back_status=function(b,c,d,e,f){var g=1;d&&(g=parseFloat(this.event_power));var h=Math.ceil(b*g);h=Math.ceil(h*a.BACK_MEMBER_COEFFICIENT),h*=e,h*=f;var i=1+c/100;return h*=i,h=Math.round(10*h)/10,Math.ceil(h)},a.prototype.calc_live_royal_damage=function(){return Math.floor(this.actual_offense)*a.LIVE_ROYAL_DAMAGE_COEFFICIENT},a.prototype.calculation_live_trial=function(a,b,c,d){var e=parseInt(this.offense),f=parseInt(this.defense),g=parseFloat(this.offense_skill),h=parseFloat(this.defense_skill),i=0,j=0;c?(i=this.calc_live_trial_front_status(e,g,a,b,d),j=this.calc_live_trial_front_status(f,h,a,b,d)):(i=this.calc_live_trial_back_status(e,g,a,b),j=this.calc_live_trial_back_status(f,h,a,b)),this.actual_offense=i,this.actual_defense=j},a.prototype.calc_live_trial_front_status=function(b,c,d,e,f){var g=this.get_cost();d&&(b=this.get_cost_corrected_status(b,g,e));var h=1;return parseInt(this.type)==f&&(h+=a.PRODUCER_TYPE_COEFFICIENT),h+=c/100,b=Math.ceil(b*h)},a.prototype.calc_live_trial_back_status=function(b,c,d,e){var f=this.get_cost(),g=Math.floor(b*a.BACK_MEMBER_COEFFICIENT),h=g;if(d&&(h=this.get_cost_corrected_status(h,f,e),f>e&&(h*=a.BACK_MEMBER_COEFFICIENT)),!d||e>=f){var i=c/100;h=Math.floor(h)+Math.ceil(g*i*10)/10}return Math.floor(h)},a.prototype.calculation_talk_battle=function(a,b,c,d,e,f){var g=parseInt(this.offense),h=parseInt(this.defense),i=parseFloat(this.offense_skill),j=parseFloat(this.defense_skill),k=0,l=0;a?(k=this.calc_talk_battle_front_status(g,i,b,c,d,e,f),l=this.calc_talk_battle_front_status(h,j,b,c,d,e,f)):(k=this.calc_talk_battle_back_status(g,i,d,e),l=this.calc_talk_battle_back_status(h,j,d,e)),this.actual_offense=k,this.actual_defense=l},a.prototype.calc_talk_battle_front_status=function(b,c,d,e,f,g,h){var i=Math.floor(b*parseFloat(this.event_power)),j=1+this.get_type_ratio(d,e);return i=Math.ceil(i*j),j=1+c/100,i=Math.round(i*j),j=1+h/100,i=Math.round(i*j),j=1+Math.sqrt(a.TALK_BATTLE_COMBO_LEVEL_COEFFICIENT*f)/100,i=Math.round(i*j),j=1+g/100,i=Math.ceil(i*j)},a.prototype.calc_talk_battle_back_status=function(b,c,d,e){var f=Math.floor(b*parseFloat(this.event_power));f=Math.ceil(f*a.BACK_MEMBER_COEFFICIENT);var g=1+c/100;return f=Math.round(f*g),g=1+Math.sqrt(a.TALK_BATTLE_COMBO_LEVEL_COEFFICIENT*d)/100,f=Math.round(f*g),g=1+e/100,f=Math.ceil(f*g)},a.prototype.calc_talk_battle_damage=function(b){var c=Math.floor(this.actual_offense);return b&&(c*=a.TALK_BATTLE_FULL_POWER_LIVE_COEFFICIENT),c/=5},a.prototype.calculation_challenge=function(a,b,c,d,e,f){var g=parseInt(this.offense),h=parseInt(this.defense),i=parseFloat(this.offense_skill),j=parseFloat(this.defense_skill),k=0,l=0;a?(k=this.calc_challenge_front_status(g,i,b,c,d,e,f),l=this.calc_challenge_front_status(h,j,b,c,d,e,f)):(k=this.calc_challenge_back_status(g,i,d),l=this.calc_challenge_back_status(h,j,d)),this.actual_offense=k,this.actual_defense=l},a.prototype.calc_challenge_front_status=function(a,b,c,d,e,f,g){var h=parseFloat(this.event_power);parseInt(this.type)==e&&(h*=2);var i=Math.floor(a*h);return h=1+f/100,i=Math.floor(i*h),h=1+this.get_type_ratio(c,d),i=Math.ceil(i*h),h=1+b/100,i=Math.round(i*h),h=1+g/100,i=Math.round(i*h)},a.prototype.calc_challenge_back_status=function(b,c,d){var e=parseFloat(this.event_power);parseInt(this.type)==d&&(e*=2);var f=Math.floor(b*e);return f=Math.ceil(f*a.BACK_MEMBER_COEFFICIENT),e=1+c/100,f=Math.round(f*e)},a.prototype.calc_challenge_damage=function(){return Math.floor(this.actual_offense)/5},a.TRAINER_COST=999,a.PRODUCER_TYPE_COEFFICIENT=.05,a.INSTITUTION_COEFFICIENT=.05,a.BACK_MEMBER_COEFFICIENT=.8,a.HIGH_TENSION_BONUS_COEFFICIENT=.1,a.COMPATIBILITY_BONUS_COEFFICIENT=.2,a.GROOVE_BONUS_COEFFICIENT=.2,a.LIVE_TOUR_NORMAL_LIVE_COEFFICIENT=.5,a.LIVE_TOUR_FULL_POWER_LIVE_COEFFICIENT=2,a.LIVE_ROYAL_DAMAGE_COEFFICIENT=.2,a.DREAM_LIVE_FESTIVAL_NORMAL_LIVE_COEFFICIENT=.5,a.DREAM_LIVE_FESTIVAL_FULL_POWER_LIVE_COEFFICIENT=2.5,a.DREAM_LIVE_FESTIVAL_COMBO_LEVEL_COEFFICIENT=125,a.TALK_BATTLE_FULL_POWER_LIVE_COEFFICIENT=5,a.TALK_BATTLE_COMBO_LEVEL_COEFFICIENT=50,a}(),UserPetitIdol=function(){function a(){this.type="0",this.vocal="0",this.dance="0",this.visual="0",this.status=0,ko.track(this)}return a.prototype.calc_status=function(b){void 0===b&&(b=-1);var c=0,d=parseInt(this.type),e=1+a.TYPE_BONSU_COEFFICIENT,f=parseInt(this.vocal);isNaN(f)||(d==b&&(f=Math.ceil(f*e)),c+=f);var g=parseInt(this.dance);isNaN(g)||(d==b&&(g=Math.ceil(g*e)),c+=g);var h=parseInt(this.visual);isNaN(h)||(d==b&&(h=Math.ceil(h*e)),c+=h),this.status=c},a.prototype.get_setting=function(){var a={};return a.type=this.type,a.vocal=this.vocal,a.dance=this.dance,a.visual=this.visual,a},a.prototype.set_setting=function(a){this.type=a.type,this.vocal=a.vocal,this.dance=a.dance,this.visual=a.visual},a.TYPE_BONSU_COEFFICIENT=.2,a}(),CALCULATION_TYPE;!function(a){a[a.NORMAL=0]="NORMAL",a[a.SURVIVAL=1]="SURVIVAL",a[a.FESTIVAL=2]="FESTIVAL",a[a.LIVE_TOUR=3]="LIVE_TOUR",a[a.SESSION=4]="SESSION",a[a.DREAM_LIVE_FESTIVAL=5]="DREAM_LIVE_FESTIVAL",a[a.ROYAL=6]="ROYAL",a[a.ROYAL_GUEST=7]="ROYAL_GUEST",a[a.TALK_BATTLE=8]="TALK_BATTLE",a[a.CHALLENGE=9]="CHALLENGE",a[a.FESTIVAL_S=10]="FESTIVAL_S"}(CALCULATION_TYPE||(CALCULATION_TYPE={}));var SKILL_TARGET_UNIT;!function(a){a[a.OWN=0]="OWN",a[a.RIVAL=1]="RIVAL"}(SKILL_TARGET_UNIT||(SKILL_TARGET_UNIT={}));var SKILL_TARGET_MEMBER;!function(a){a[a.SELF=0]="SELF",a[a.FRONT=1]="FRONT",a[a.BACK=2]="BACK",a[a.ALL=3]="ALL"}(SKILL_TARGET_MEMBER||(SKILL_TARGET_MEMBER={}));var SKILL_TARGET_TYPE;!function(a){a[a.CUTE=1]="CUTE",a[a.COOL=2]="COOL",a[a.PASSION=4]="PASSION",a[a.ALL=7]="ALL"}(SKILL_TARGET_TYPE||(SKILL_TARGET_TYPE={}));var SKILL_TARGET_PARAM;!function(a){a[a.ALL=0]="ALL",a[a.OFFENSE=1]="OFFENSE",a[a.DEFENSE=2]="DEFENSE"}(SKILL_TARGET_PARAM||(SKILL_TARGET_PARAM={}));var SKILL_INPUT_MODE;!function(a){a[a.MANUAL=0]="MANUAL",a[a.AUTO=1]="AUTO",a[a.AUTO_MEAN=2]="AUTO_MEAN"}(SKILL_INPUT_MODE||(SKILL_INPUT_MODE={}));var ENABLE_SKILL_TYPE;!function(a){a[a.ALL=0]="ALL",a[a.OFFENSE=1]="OFFENSE",a[a.DEFENSE=2]="DEFENSE"}(ENABLE_SKILL_TYPE||(ENABLE_SKILL_TYPE={}));var BaseLiveCalcViewModel=function(){function a(){var a=this;this.calc_type=0..toString(),this.front_num="0",this.producer_type="-1",this.appeal_bonus=["0","0","0"],this.training_room_level="0",this.idol_list=[],this.petit_idol_list=[],this.skill_input_type="0",this.enable_skill_type="0",this.rival_front_num=["0","0","0"],this.rival_back_num=["0","0","0"],this.max_skill_invoke=0,this.skill_invocation_rate_list=[],this.save_data_key="",this.save_data_id="1",this.save_data_title="",this.code="",this.apply_code_url="",this.move_up=function(){var b=a.idol_list.indexOf(this);b>0&&a.idol_list.splice(b-1,2,a.idol_list[b],a.idol_list[b-1])},this.move_down=function(){var b=a.idol_list.indexOf(this);b<a.idol_list.length-1&&a.idol_list.splice(b,2,a.idol_list[b+1],a.idol_list[b])}}return a.prototype.actual_status=function(){return[0,0]},a.prototype.change_appeal_bonus=function(){ko.valueHasMutated(this,"appeal_bonus")},a.prototype.change_rival_front_num=function(){ko.valueHasMutated(this,"rival_front_num")},a.prototype.change_rival_back_num=function(){ko.valueHasMutated(this,"rival_back_num")},a.prototype.init_list=function(){this.init_idol_list(),this.init_petit_idol_list();var a=Common.get_param_list();a.code&&(this.code=a.code,this.apply_code())},a.prototype.init_idol_list=function(){},a.prototype.init_petit_idol_list=function(){for(var a=[],b=0;b<ViewModel.PETIT_IDOL_NUM;b++){var c=new UserPetitIdol;a.push(c)}this.petit_idol_list=a},a.prototype.calc_petit_idol_bonus=function(a){void 0===a&&(a=-1);for(var b=0,c=0;c<this.petit_idol_list.length;c++){var d=this.petit_idol_list[c];d.calc_status(a),b+=d.status}return b},a.prototype.is_smartphone=function(){return Common.is_smartphone()},a.prototype.get_setting=function(){return{}},a.prototype.set_setting=function(){},a.prototype.get_idol_setting=function(){for(var a=[],b=0;b<this.idol_list.length;b++)a.push(this.idol_list[b].get_setting());return a},a.prototype.set_idol_setting=function(a,b){var c=this;void 0===b&&(b=-1);for(var d=jQuery.Deferred(),e={},f=0;f<a.length;f++){var g="t"+a[f].type+"_r"+a[f].rarity;g in e||(e[g]={type:a[f].type,rarity:a[f].rarity})}for(var h=Object.keys(e),i=[],f=0;f<h.length;f++){var j=e[h[f]];i.push(Common.load_idol_list(parseInt(j.type),parseInt(j.rarity)))}return-1==b&&(b=a.length),jQuery.when.apply(null,i).done(function(){for(var e=[],f=0;f<a.length&&b>f;f++){var g=new UserIdol(!1);g.set_setting(a[f]),e.push(g)}for(var f=e.length;b>f;f++){var g=new UserIdol(!1);e.push(g)}c.idol_list=e,d.resolve()}),d.promise()},a.prototype.get_appeal_bonus_setting=function(){for(var a=[],b=0;b<this.appeal_bonus.length;b++){var c={};c.type=b.toString(),c.value=this.appeal_bonus[b],a.push(c)}return a},a.prototype.set_appeal_bonus_setting=function(a){if(void 0!=a){for(var b=this.appeal_bonus,c=0;c<a.length;c++)if(void 0!=a[c]){var d=a[c];b[d.type]=d.value}this.appeal_bonus=b,this.change_appeal_bonus()}},a.prototype.get_rival_member_setting=function(){var a={};a.front=[];for(var b=0;b<this.rival_front_num.length;b++){var c={};c.type=b.toString(),c.value=this.rival_front_num[b],a.front.push(c)}a.back=[];for(var b=0;b<this.rival_back_num.length;b++){var c={};c.type=b.toString(),c.value=this.rival_back_num[b],a.back.push(c)}return a},a.prototype.set_rival_member_setting=function(a){if(void 0!=a){if(void 0!=a.front){for(var b=this.rival_front_num,c=0;c<a.front.length;c++)if(void 0!=a.front[c]){var d=a.front[c];b[d.type]=d.value}this.rival_front_num=b,this.change_rival_front_num()}if(void 0!=a.back){for(var e=this.rival_back_num,c=0;c<a.back.length;c++)if(void 0!=a.back[c]){var d=a.back[c];e[d.type]=d.value}this.rival_back_num=e,this.change_rival_back_num()}}},a.prototype.get_petit_idol_setting=function(){for(var a=[],b=0;b<this.petit_idol_list.length;b++)a.push(this.petit_idol_list[b].get_setting());return a},a.prototype.set_petit_idol_setting=function(a,b){if(null!=a){for(var c=[],d=0;d<a.length&&d!=b;d++){var e=new UserPetitIdol;e.set_setting(a[d]),c.push(e)}this.petit_idol_list=c}},a.prototype.save_setting=function(){try{var a=this.save_data_key+"_title_"+this.save_data_id;localStorage.setItem(a,this.save_data_title),a=this.save_data_key+"_"+this.save_data_id,localStorage.setItem(a,JSON.stringify(this.get_setting()))}catch(b){console.log(b.message),alert("データ保存時にエラーが発生しました。")}},a.prototype.load_setting=function(){try{var a=this.save_data_key+"_title_"+this.save_data_id,b=localStorage.getItem(a);a=this.save_data_key+"_"+this.save_data_id;var c=localStorage.getItem(a);if(null!=c){null==b&&(b="");var d=JSON.parse(c);this.save_data_title=b,this.set_setting(d)}else alert("データが保存されていません。")}catch(e){console.log(e.message),alert("データ読み込み時にエラーが発生しました。")}},a.prototype.generate_code=function(){var a=this.get_setting(),b=JSON.stringify(a);try{var c=Common.get_compress_data(b),d=Common.get_page_url()+"?code="+c;this.code=c,this.apply_code_url=d}catch(e){console.log(e.message),alert("コードの生成に失敗しました。")}},a.prototype.apply_code=function(){try{var a=Common.get_decompress_data(this.code),b=JSON.parse(a),c=Common.get_page_url()+"?code="+this.code;this.set_setting(b),this.apply_code_url=c}catch(d){console.log(d.message),alert("コードの適用に失敗しました。")}},a.prototype.is_skill_input_type_manual=function(){return 0==parseInt(this.skill_input_type)},a.prototype.calc_skill_value=function(){var a=this;if(!this.is_skill_input_type_manual()){for(var b=0;b<this.idol_list.length;b++){var c=this.idol_list[b];c.offense_skill="0",c.defense_skill="0",c.enable_skill=!1}jQuery.when(this.get_invoke_skill_list()).done(function(b){for(var c=0;c<b.length;c++){var d=b[c],e=parseInt(d.target_member);switch(e){case 0:break;case 1:a.apply_skill_effect_front_member(d,c);break;case 2:a.apply_skill_effect_back_member(d,c);break;case 3:a.apply_skill_effect_front_member(d,c),a.apply_skill_effect_back_member(d,c)}}})}},a.prototype.get_invoke_skill_list=function(){for(var a=this,b=parseInt(this.front_num),c=[[0,0,0],[0,0,0]],d=0;d<this.idol_list.length;d++){var e=parseInt(this.idol_list[d].type);b>d?c[0][e]++:c[1][e]++}for(var f=[[0,0,0],[0,0,0]],d=0;d<this.rival_front_num.length;d++)f[0][d]=parseInt(this.rival_front_num[d]);for(var d=0;d<this.rival_back_num.length;d++)f[1][d]=parseInt(this.rival_back_num[d]);var g=jQuery.Deferred();return jQuery.when(Common.load_skill_list()).done(function(d){for(var e=[],h=0,i=parseInt(a.skill_input_type),j=0;j<a.idol_list.length&&b>j;j++){var k=a.idol_list[j];if(parseInt(k.skill_id)>0&&parseInt(k.skill_level)>0){var l=a.check_skill_enable(k,d,h,c,f);if(null!=l&&(k.enable_skill=!0,e.push(l),h++),2!=i&&h>=a.max_skill_invoke)break}}g.resolve(e)}),g.promise()},a.prototype.check_skill_enable=function(a,b,c,d,e){var f=jQuery.extend(!0,{},b[a.skill_id]);if(f.skill_level=parseInt(a.skill_level),0==f.skill_value_list.length)return null;var g=parseInt(f.target_unit);return 0==g?this.check_target_own_unit_skill_enable(f,d,a,c):this.check_target_rival_unit_skill_enable(f,e)},a.prototype.check_target_own_unit_skill_enable=function(a,b,c,d){var e=parseInt(this.enable_skill_type),f=parseInt(a.target_param),g=parseInt(a.target_member),h=parseInt(a.target_type);return 0!=e&&0!=f&&e!=f?null:0==g?(this.apply_skill_effect(c,a,d),a):this.check_skill_target(g,h,b)?a:null},a.prototype.check_target_rival_unit_skill_enable=function(a){var b=parseInt(this.enable_skill_type),c=parseInt(a.target_param);return 0!=b&&0==(b^c)?null:a},a.prototype.check_skill_target=function(a,b,c){var d=!1;switch(a){case 1:for(var e=0;e<c[0].length;e++)if((b&1<<e)>0&&c[0][e]>0){d=!0;break}break;case 2:for(var e=0;e<c[1].length;e++)if((b&1<<e)>0&&c[1][e]>0){d=!0;break}break;case 3:for(var e=0;e<c.length;e++)for(var f=0;f<c[e].length;f++)if((b&1<<f)>0&&c[e][f]>0){d=!0;break}}return d},a.prototype.apply_skill_effect_front_member=function(a,b){for(var c=parseInt(this.front_num),d=0;d<this.idol_list.length&&c>d;d++)this.apply_skill_effect(this.idol_list[d],a,b)},a.prototype.apply_skill_effect_back_member=function(a,b){var c=parseInt(a.target_num),d=parseInt(this.front_num);-1==c&&(c=this.idol_list.length-d);for(var e=0,f=d;f<this.idol_list.length&&c>e;f++)this.apply_skill_effect(this.idol_list[f],a,b)&&e++},a.prototype.apply_skill_effect=function(a,b,c){if(!this.check_apply_skill(a,b))return!1;var d=parseInt(b.target_param),e=parseInt(b.skill_level),f=0;if(e>0&&(f=parseInt(b.skill_value_list[e-1])),2==parseInt(this.skill_input_type)){var g=this.skill_invocation_rate_list[c];void 0!=g&&(f*=g/100)}return this.apply_skill_value(a,d,f)},a.prototype.apply_skill_value=function(a,b,c){var d=!1,e=parseFloat(a.offense_skill),f=parseFloat(a.defense_skill);switch(b){case 0:e+=c,f+=c,d=!0;break;case 1:e+=c,d=!0;break;case 2:f+=c,d=!0}return a.offense_skill=e.toString(),a.defense_skill=f.toString(),d},a.prototype.check_apply_skill=function(a,b){var c=!1,d=parseInt(a.type),e=parseInt(b.target_unit),f=parseInt(b.target_member),g=parseInt(b.target_type);return 0==e&&(0==f||(g&1<<d)>0)&&(c=!0),c},a.PETIT_IDOL_NUM=3,a}(),__extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},DamageValue=function(){function a(a){void 0===a&&(a=0),this.value=a}return a.prototype.get_turn_damage=function(){return Math.ceil(this.value)},a.prototype.get_battle_damage=function(){return this.get_turn_damage()*a.BATTLE_DAMAGE_COEFFICIENT},a.BATTLE_DAMAGE_COEFFICIENT=5,a}(),Damage=function(){function a(a,b){void 0===a&&(a=""),void 0===b&&(b=0),this.name=a,this.min=new DamageValue(b),this.max=new DamageValue(b),this.avg=new DamageValue(b)}return a.prototype.add_damage=function(b){this.min.value+=Math.ceil(b*a.COEFFICIENT_MIN*10)/10,this.max.value+=Math.ceil(b*a.COEFFICIENT_MAX*10)/10,this.avg.value+=Math.ceil(b*a.COEFFICIENT_AVG*10)/10},a.prototype.add_bonus=function(a){this.min.value+=a,this.max.value+=a,this.avg.value+=a},a.COEFFICIENT_MIN=.97,a.COEFFICIENT_MAX=1.02,a.COEFFICIENT_AVG=.995,a}(),BaseLiveTourCalcViewModel=function(a){function b(){a.call(this),this.max_member_num=20,this.front_num="10",this.voltage_bonus="0",this.max_skill_invoke=5,this.skill_invocation_rate_list=[100,50,37.5,29.6875,24.51171875,20.880126953125,18.195724487304688,16.121602058410645,14.460162818431854,13.09043737128377],this.front_offense=0,this.front_defense=0,this.back_offense=0,this.back_defense=0,this.damage_list=[]}return __extends(b,a),b.prototype.init_idol_list=function(){for(var a=this.max_member_num,b=[],c=this.idol_list,d=0;d<c.length;d++)b.push(c[d].get_setting());for(var e=[],d=0;a>d;d++){var f=new UserIdol(!1);null!=b[d]&&f.set_setting(b[d]),e.push(f)}this.idol_list=e},b.prototype.get_setting=function(){var a={};return a.producer_type=this.producer_type,a.appeal_bonus=this.get_appeal_bonus_setting(),a.training_room_level=this.training_room_level,a.calc_type=this.calc_type,a.skill_input_type=this.skill_input_type,a.enable_skill_type=this.enable_skill_type,a.rival_member=this.get_rival_member_setting(),a.idol=this.get_idol_setting(),a.petit_idol=this.get_petit_idol_setting(),a},b.prototype.set_setting=function(a){this.producer_type=a.producer_type,this.set_appeal_bonus_setting(a.appeal_bonus),this.training_room_level=a.training_room_level,this.calc_type=a.calc_type,this.skill_input_type=a.skill_input_type,this.enable_skill_type=a.enable_skill_type,this.set_rival_member_setting(a.rival_member),this.set_idol_setting(a.idol,this.max_member_num),this.set_petit_idol_setting(a.petit_idol,ViewModel.PETIT_IDOL_NUM)},b.prototype.check_target_rival_unit_skill_enable=function(a,b){var c=parseInt(this.enable_skill_type),d=parseInt(a.target_param),e=parseInt(a.target_member),f=parseInt(a.target_type);if(0!=c&&0==(c^d))return null;if(1!=e&&3!=e)return null;if(this.check_skill_target(e,f,b)){switch(d){case 1:d=2;break;case 2:d=1}a.target_member=1,a.target_param=d}else a.skill_level=0;return a},b.prototype.check_apply_skill=function(a,b){var c=!1,d=parseInt(a.type),e=parseInt(b.target_unit),f=parseInt(b.target_member),g=parseInt(b.target_type);return 0==e?(0==f||(g&1<<d)>0)&&(c=!0):1==e&&(c=!0),c},b}(BaseLiveCalcViewModel),ViewModel=function(a){function b(){a.call(this),this.calc_type=6..toString(),this.battle_point="2",this.save_data_key="imas_cg_live_royal_calc",this.init_list(),ko.track(this)}return __extends(b,a),b.prototype.actual_status=function(){return this.calculation()},b.prototype.is_guest_live=function(){return 7==parseInt(this.calc_type)},b.prototype.calculation=function(){this.calc_skill_value();var a=parseInt(this.battle_point),c=b.BATTLE_POINT_RATE_LIST[a-1];this.is_guest_live()&&(c=b.GUEST_BATTLE_POINT_RATE_LIST[a-1]);for(var d=parseInt(this.front_num),e=parseInt(this.producer_type),f=parseFloat(this.voltage_bonus),g=parseInt(this.training_room_level),h=this.is_guest_live(),i=0,j=0,k=new Damage,l=0,m=0,n=0,o=0,p=0;p<this.idol_list.length;p++){var q=this.idol_list[p],r=d>p;q.calculation_live_royal(r,h,e,this.appeal_bonus,f,c,g);var s=q.actual_offense,t=q.actual_defense;r?(l+=s,m+=t):(n+=s,o+=t),i+=s,j+=t,h&&k.add_damage(q.calc_live_royal_damage()),q.style="numeric "+(r?"front":"back")}this.front_offense=l,this.front_defense=m,this.back_offense=n,this.back_defense=o;var u=this.calc_petit_idol_bonus();return u=Math.ceil(u*c*f),i+=u,j+=u,k.add_bonus(Math.floor(u*UserIdol.LIVE_ROYAL_DAMAGE_COEFFICIENT)),this.damage_list=[k],[i,j]},b.prototype.get_setting=function(){var b=a.prototype.get_setting.call(this);return b.battle_point=this.battle_point,b.voltage_bonus=this.voltage_bonus,b},b.prototype.set_setting=function(b){a.prototype.set_setting.call(this,b),this.battle_point=b.battle_point,this.voltage_bonus=b.voltage_bonus},b.prototype.check_target_rival_unit_skill_enable=function(b,c){if(this.is_guest_live())return a.prototype.check_target_rival_unit_skill_enable.call(this,b,c);var d=parseInt(this.enable_skill_type),e=parseInt(b.target_param);return 0!=d&&0==(d^e)?null:b},b.prototype.check_apply_skill=function(b,c){if(this.is_guest_live())return a.prototype.check_apply_skill.call(this,b,c);var d=!1,e=parseInt(b.type),f=parseInt(c.target_unit),g=parseInt(c.target_member),h=parseInt(c.target_type);
return 0==f&&(0==g||(h&1<<e)>0)&&(d=!0),d},b.BATTLE_POINT_RATE_LIST=[.8,1,1.5,2,2.5],b.GUEST_BATTLE_POINT_RATE_LIST=[.5,1,1.6,2.25,3],b}(BaseLiveTourCalcViewModel);jQuery(function(){ko.applyBindings(new ViewModel)});