var SKILL_TARGET_UNIT,SKILL_TARGET_MEMBER,SKILL_TARGET_TYPE,SKILL_TARGET_PARAM,Common=function(){function t(){}return t.load_idol_list=function(t,e,i){var s=this;void 0===i&&(i=[]);var _=this.IDOL_LIST_KEY_BASE;-1==t&&-1==e?_+="_all":(-1!=t&&(_+="_t"+t),-1!=e&&(_+="_r"+e));var a=this.cache_data[_],l=jQuery.Deferred();if(null!=a)l.resolve(JSON.parse(a));else{var r={};-1!=t&&(r.type=t),-1!=e&&(r.rarity=e),0<i.length&&(r.fields=i.join(" ")),jQuery.post(this.IDOL_DATA_API_URL,r,function(t){s.cache_data[_]=JSON.stringify(t.results),l.resolve(t.results)},"json")}return l.promise()},t.load_skill_list=function(){var e=this,i=this.SKILL_LIST_KEY,t=this.cache_data[i],s=jQuery.Deferred();return null!=t?s.resolve(JSON.parse(t)):jQuery.post(this.SKILL_DATA_API_URL,function(t){e.cache_data[i]=JSON.stringify(t),s.resolve(t)},"json"),s.promise()},t.get_compress_data=function(t){for(var e=[],i=0;i<t.length;i++){var s=t.charCodeAt(i),_=parseInt(s.toString(),10);e.push(_)}var a=new Zlib.Deflate(e).compress(),l="";for(i=0;i<a.length;i++)l+=("0"+a[i].toString(16)).slice(-2);return l},t.get_decompress_data=function(t){for(var e=[],i=0;i<t.length;i+=2)e.push(parseInt(t.substr(i,2),16));var s=new Zlib.Inflate(e).decompress(),_="";for(i=0;i<s.length;i++)_+=String.fromCharCode(s[i]);return _},t.get_param_list=function(){var t={},e=location.href.indexOf("?");if(-1<e)for(var i=location.href.slice(e+1).split("&"),s=0;s<i.length;s++){var _=i[s].split("=");_[1]&&(t[_[0]]=_[1])}return t},t.get_page_url=function(){var t=location.href,e=t.indexOf("?");return-1<e&&(t=t.slice(0,e)),t},t.get_qrcode_url=function(t,e){void 0===e&&(e=150);var i=[];return i.push("chs="+e+"x"+e),i.push("cht=qr"),i.push("chl="+t),this.GOOGLE_CHART_API_URL+"?"+i.join("&")},t.to_int=function(t){return t.match(/^[-+]?[0-9]+$/)||(t="0"),parseInt(t,10)},t.is_smartphone=function(){return null!=navigator.userAgent.match(/(Android|iPhone|iPad|Mobile)/g)},t.IDOL_DATA_API_URL="https://zaubermaerchen.info/imas_cg/api/idol/list/",t.IDOL_LIST_KEY_BASE="imas_cg_idol_list",t.SKILL_DATA_API_URL="https://zaubermaerchen.info/imas_cg/api/skill/list/",t.SKILL_LIST_KEY="imas_cg_skill_list",t.GOOGLE_CHART_API_URL="https://chart.apis.google.com/chart",t.cache_data={},t}(),UserIdol=function(){function f(){this.id="0",this.type="0",this.rarity="0",this.cost="0",this.offense="0",this.defense="0",this.event_power="1",this.accessories_power="1",this.offense_skill="0",this.defense_skill="0",this.skill_id="0",this.skill_level="10",this.skill_name="無し",this.is_festival=!1,this.is_survival=!1,this.enable_skill=!1,this.actual_offense=0,this.actual_defense=0,this.style="numeric",this.idol_data_list=[],this.skill_data_list=[],this.set_idol_list(),this.set_skill_list(),ko.track(this)}return f.prototype.display_offense=function(){return Math.ceil(this.actual_offense)},f.prototype.display_defense=function(){return Math.ceil(this.actual_defense)},f.prototype.status=function(){return parseInt(this.offense)+parseInt(this.defense)},f.prototype.offense_per_cost=function(){return this.calc_cost_ratio(parseInt(this.offense))},f.prototype.defense_per_cost=function(){return this.calc_cost_ratio(parseInt(this.defense))},f.prototype.status_per_cost=function(){return this.calc_cost_ratio(this.status())},f.prototype.select_idol_list=function(){return this.idol_data_list},f.prototype.select_skill_list=function(){return this.skill_data_list},f.prototype.get_cost=function(){var t=parseInt(this.cost);return this.is_festival&&t==f.TRAINER_COST&&(t=5),t},f.prototype.calc_cost_ratio=function(t){var e=parseInt(this.cost),i=0;return 0<e&&(i=Math.round(t/e*100)/100),i},f.prototype.get_cost_corrected_status=function(t,e,i){if(i<e){var s=i/e;t=(this.is_survival||this.is_festival||(s=Math.ceil(10*s)/10),Math.ceil(t*s))}return t},f.prototype.set_idol_list=function(){var e=this,i=jQuery.Deferred(),t=parseInt(this.type),s=parseInt(this.rarity);return jQuery.when(this.load_idol_list(t,s)).done(function(t){e.set_select_idol_list(t),e.id="0",e.cost="0",e.offense="0",e.defense="0",e.offense_skill="0",e.defense_skill="0",e.skill_level="10",e.set_skill_info(null),i.resolve()}),i.promise()},f.prototype.set_select_idol_list=function(t){var e=[];for(var i in e.push({id:"0",name:"-"}),t)if(t.hasOwnProperty(i)){var s=t[i];e.push({id:s.idol_id,name:s.name})}this.idol_data_list=e},f.prototype.set_skill_list=function(){var _=this,a=jQuery.Deferred();return jQuery.when(Common.load_skill_list()).done(function(t){var e=[];for(var i in e.push({id:"0",name:"-"}),t)if(t.hasOwnProperty(i)){var s=t[i];e.push({id:s.skill_id,name:s.comment})}_.skill_data_list=e,a.resolve()}),a.promise()},f.prototype.change_idol=function(){var i=this,t=parseInt(this.type),e=parseInt(this.rarity),s=parseInt(this.id);this.offense_skill="0",this.defense_skill="0",isNaN(s)||0==s?(this.cost="0",this.offense="0",this.defense="0",this.set_skill_info(null)):jQuery.when(this.load_idol_list(t,e)).done(function(t){var e=t[i.id];i.cost=e.cost,i.offense=e.max_offense,i.defense=e.max_defense,i.set_skill_info(e)})},f.prototype.set_skill_info=function(t){var e="0",i="無し";null!=t&&(e=t.skill_id,null!=t.skill_name&&""!=t.skill_name&&(i=t.skill_name)),this.skill_name=i,this.skill_id=e},f.prototype.get_setting=function(){var t={};return t.type=this.type,t.rarity=this.rarity,t.id=this.id,t.cost=this.cost,t.offense=this.offense,t.defense=this.defense,t.event_power=this.event_power,t.accessories_power=this.accessories_power,t.offense_skill=this.offense_skill,t.defense_skill=this.defense_skill,t.skill_id=this.skill_id,t.skill_level=this.skill_level,t},f.prototype.set_setting=function(e){var i=this;this.type=e.type,this.rarity=e.rarity,jQuery.when(this.load_idol_list(parseInt(e.type),parseInt(e.rarity))).done(function(t){i.set_select_idol_list(t),i.id=e.id,null!=e.cost&&(i.cost=e.cost),i.offense=e.offense,i.defense=e.defense,i.event_power=e.event_power,e.accessories_power&&(i.accessories_power=e.accessories_power),i.offense_skill=e.offense_skill,i.defense_skill=e.defense_skill,i.set_skill_setting(t[e.id],e.skill_id,e.skill_level)})},f.prototype.set_skill_setting=function(t,e,i){var s=this;this.set_skill_info(t),this.skill_level=i,jQuery.when(Common.load_skill_list()).done(function(t){t.hasOwnProperty(e)&&(s.skill_id=e)})},f.prototype.get_type_ratio=function(t,e){var i=parseInt(this.type),s=0;return s+=i==t?f.PRODUCER_TYPE_COEFFICIENT:parseInt(e[i])/100},f.prototype.load_idol_list=function(t,e){var i=jQuery.Deferred();return jQuery.when(Common.load_idol_list(t,e,["type","rarity","name","cost","max_offense","max_defense","skill_name","skill_id"])).done(function(t){i.resolve(t)}),i.promise()},f.prototype.calculation=function(t,e,i,s,_,a,l){var r=0,n=0;if(!t||1<=e){var o=parseInt(this.offense),c=parseInt(this.defense),p=parseFloat(this.offense_skill),h=parseFloat(this.defense_skill);n=i?(r=this.calc_front_status(o,p,t,e,s,_,a,l),this.calc_front_status(c,h,t,e,s,_,a,l)):(r=this.calc_back_status(o,p,t,e),this.calc_back_status(c,h,t,e))}this.actual_offense=r,this.actual_defense=n},f.prototype.calculation_festival=function(t,e,i,s,_,a,l,r,n,o){var c=parseInt(this.offense),p=parseInt(this.defense),h=parseFloat(this.offense_skill),u=parseFloat(this.defense_skill),f=0,v=0;v=i?(f=this.calc_festival_front_status(c,h,t,e,s,_,a,l,r,n,o),this.calc_festival_front_status(p,u,t,e,s,_,a,l,r,n,-1)):(f=this.calc_back_status(c,h,t,e),this.calc_back_status(p,u,t,e)),this.actual_offense=f,this.actual_defense=v},f.prototype.calc_front_status=function(t,e,i,s,_,a,l,r){i&&(t=this.get_cost_corrected_status(t,this.get_cost(),s));for(var n=parseInt(this.type),o=0;o<l.length;o++)if(n==parseInt(l[o])){t=Math.ceil(t*(1+f.INSTITUTION_COEFFICIENT));break}var c=1+this.get_type_ratio(_,a)+(r+e)/100;return t=Math.ceil(t*c)},f.prototype.calc_back_status=function(t,e,i,s){var _=this.get_cost(),a=Math.ceil(t*f.BACK_MEMBER_COEFFICIENT);i&&(a=this.get_cost_corrected_status(a,_,s));var l=1+e/100;return a=Math.floor(a*l*10)/10},f.prototype.calc_festival_front_status=function(t,e,i,s,_,a,l,r,n,o,c){i&&(t=this.get_cost_corrected_status(t,this.get_cost(),s));for(var p=parseInt(this.type),h=0;h<l.length;h++)if(p==parseInt(l[h])){t=Math.ceil(t*(1+f.INSTITUTION_COEFFICIENT));break}var u=1+this.get_type_ratio(_,a)+(e+n)/100;return t=Math.ceil(t*u),t*=u=1+r/100,u=1,p==c&&(u+=f.GROOVE_BONUS_COEFFICIENT),t=Math.round(t*u),u=1,o&&(u+=f.HIGH_TENSION_BONUS_COEFFICIENT),t=Math.round(t*u)},f.prototype.calculation_survival=function(t,e){this.is_survival=!0;var i=Math.floor(parseInt(this.offense)*parseFloat(this.event_power));t&&(i=this.get_cost_corrected_status(i,this.get_cost(),e)),this.actual_offense=i},f.prototype.calculation_live_tour=function(t,e,i,s){var _=parseInt(this.offense),a=parseInt(this.defense),l=parseFloat(this.offense_skill),r=parseFloat(this.defense_skill),n=0,o=0;o=t?(n=this.calc_live_tour_front_status(_,l,e,i,s),this.calc_live_tour_front_status(a,r,e,i,s)):(n=this.calc_live_tour_back_status(_,l),this.calc_live_tour_back_status(a,r)),this.actual_offense=n,this.actual_defense=o},f.prototype.calc_live_tour_front_status=function(t,e,i,s,_){var a=Math.ceil(t*parseFloat(this.accessories_power));a=Math.floor(a*parseFloat(this.event_power));var l=1+this.get_type_ratio(i,s)+(e+_)/100;return a=Math.ceil(a*l)},f.prototype.calc_live_tour_back_status=function(t,e){var i=Math.floor(t*parseFloat(this.event_power));i=Math.ceil(i*f.BACK_MEMBER_COEFFICIENT);var s=1+e/100;return i=Math.ceil(i*s)},f.prototype.calculation_dream_live_festival=function(t,e,i,s,_,a){var l=parseInt(this.offense),r=parseInt(this.defense),n=parseFloat(this.offense_skill),o=parseFloat(this.defense_skill),c=0,p=0;p=t?(c=this.calc_dream_live_festival_front_status(l,n,e,i,s,_,a),this.calc_dream_live_festival_front_status(r,o,e,i,s,_,a)):(c=this.calc_dream_live_festival_back_status(l,n,_),this.calc_dream_live_festival_back_status(r,o,_)),this.actual_offense=c,this.actual_defense=p},f.prototype.calc_dream_live_festival_front_status=function(t,e,i,s,_,a,l){var r=Math.floor(t*parseFloat(this.event_power)),n=1+a/100;return r=Math.floor(r*n),n=1+this.get_type_ratio(i,s)+(e+l)/100,r=Math.ceil(r*n),n=1,n+=Math.sqrt(f.DREAM_LIVE_FESTIVAL_COMBO_LEVEL_COEFFICIENT*_)/100,r=Math.ceil(r*n)},f.prototype.calc_dream_live_festival_back_status=function(t,e,i){var s=Math.floor(t*parseFloat(this.event_power));s=Math.ceil(s*f.BACK_MEMBER_COEFFICIENT);var _=1+i/100;return s=Math.floor(s*_),_=1+e/100,s=Math.ceil(s*_)},f.prototype.calculation_live_royal=function(t,e,i,s,_,a,l){var r=parseInt(this.offense),n=parseInt(this.defense),o=parseFloat(this.offense_skill),c=parseFloat(this.defense_skill),p=0,h=0;h=t?(p=this.calc_live_royal_front_status(r,o,e,i,s,_,a,l),this.calc_live_royal_front_status(n,c,e,i,s,_,a,l)):(p=this.calc_live_royal_back_status(r,o,e,_,a),this.calc_live_royal_back_status(n,c,e,_,a)),this.actual_offense=p,this.actual_defense=h},f.prototype.calc_live_royal_front_status=function(t,e,i,s,_,a,l,r){var n=1;i&&(n=parseFloat(this.event_power));var o=Math.ceil(t*n);return o*=a,o*=l,o*=1+this.get_type_ratio(s,_)+(e+r)/100,o=Math.round(10*o)/10,Math.ceil(o)},f.prototype.calc_live_royal_back_status=function(t,e,i,s,_){var a=1;i&&(a=parseFloat(this.event_power));var l=Math.ceil(t*a);return l=Math.ceil(l*f.BACK_MEMBER_COEFFICIENT),l*=s,l*=_,l*=1+e/100,l=Math.round(10*l)/10,Math.ceil(l)},f.prototype.calc_live_royal_damage=function(){return Math.floor(this.actual_offense)*f.LIVE_ROYAL_DAMAGE_COEFFICIENT},f.prototype.calculation_live_trial=function(t,e,i,s){var _=parseInt(this.offense),a=parseInt(this.defense),l=parseFloat(this.offense_skill),r=parseFloat(this.defense_skill),n=0,o=0;o=i?(n=this.calc_live_trial_front_status(_,l,t,e,s),this.calc_live_trial_front_status(a,r,t,e,s)):(n=this.calc_live_trial_back_status(_,l,t,e),this.calc_live_trial_back_status(a,r,t,e)),this.actual_offense=n,this.actual_defense=o},f.prototype.calc_live_trial_front_status=function(t,e,i,s,_){var a=this.get_cost();i&&(t=this.get_cost_corrected_status(t,a,s));var l=1;return parseInt(this.type)==_&&(l+=f.PRODUCER_TYPE_COEFFICIENT),l+=e/100,t=Math.ceil(t*l)},f.prototype.calc_live_trial_back_status=function(t,e,i,s){var _=this.get_cost(),a=Math.floor(t*f.BACK_MEMBER_COEFFICIENT),l=a;if(i&&(l=this.get_cost_corrected_status(l,_,s),s<_&&(l*=f.BACK_MEMBER_COEFFICIENT)),!i||_<=s){var r=e/100;l=Math.floor(l)+Math.ceil(a*r*10)/10}return Math.floor(l)},f.prototype.calculation_talk_battle=function(t,e,i,s,_,a){var l=parseInt(this.offense),r=parseInt(this.defense),n=parseFloat(this.offense_skill),o=parseFloat(this.defense_skill),c=0,p=0;p=t?(c=this.calc_talk_battle_front_status(l,n,e,i,s,_,a),this.calc_talk_battle_front_status(r,o,e,i,s,_,a)):(c=this.calc_talk_battle_back_status(l,n,s,_),this.calc_talk_battle_back_status(r,o,s,_)),this.actual_offense=c,this.actual_defense=p},f.prototype.calc_talk_battle_front_status=function(t,e,i,s,_,a,l){var r=Math.floor(t*parseFloat(this.event_power)),n=1+this.get_type_ratio(i,s);return r=Math.ceil(r*n),n=1+e/100,r=Math.round(r*n),n=1+l/100,r=Math.round(r*n),n=1+Math.sqrt(f.TALK_BATTLE_COMBO_LEVEL_COEFFICIENT*_)/100,r=Math.round(r*n),n=1+a/100,r=Math.ceil(r*n)},f.prototype.calc_talk_battle_back_status=function(t,e,i,s){var _=Math.floor(t*parseFloat(this.event_power));_=Math.ceil(_*f.BACK_MEMBER_COEFFICIENT);var a=1+e/100;return _=Math.round(_*a),a=1+Math.sqrt(f.TALK_BATTLE_COMBO_LEVEL_COEFFICIENT*i)/100,_=Math.round(_*a),a=1+s/100,_=Math.ceil(_*a)},f.prototype.calculation_challenge=function(t,e,i,s,_,a){var l=parseInt(this.offense),r=parseInt(this.defense),n=parseFloat(this.offense_skill),o=parseFloat(this.defense_skill),c=0,p=0;p=t?(c=this.calc_challenge_front_status(l,n,e,i,s,_,a),this.calc_challenge_front_status(r,o,e,i,s,_,a)):(c=this.calc_challenge_back_status(l,n,s),this.calc_challenge_back_status(r,o,s)),this.actual_offense=c,this.actual_defense=p},f.prototype.calc_challenge_front_status=function(t,e,i,s,_,a,l){var r=parseFloat(this.event_power);parseInt(this.type)==_&&(r*=2);var n=Math.floor(t*r);return r=1+a/100,n=Math.floor(n*r),r=1+this.get_type_ratio(i,s),n=Math.ceil(n*r),r=1+e/100,n=Math.round(n*r),r=1+l/100,n=Math.round(n*r)},f.prototype.calc_challenge_back_status=function(t,e,i){var s=parseFloat(this.event_power);parseInt(this.type)==i&&(s*=2);var _=Math.floor(t*s);return _=Math.ceil(_*f.BACK_MEMBER_COEFFICIENT),s=1+e/100,_=Math.round(_*s)},f.prototype.calc_challenge_damage=function(){return Math.floor(this.actual_offense)/5},f.TRAINER_COST=999,f.PRODUCER_TYPE_COEFFICIENT=.05,f.INSTITUTION_COEFFICIENT=.05,f.BACK_MEMBER_COEFFICIENT=.8,f.HIGH_TENSION_BONUS_COEFFICIENT=.1,f.COMPATIBILITY_BONUS_COEFFICIENT=.2,f.GROOVE_BONUS_COEFFICIENT=.2,f.LIVE_TOUR_NORMAL_LIVE_COEFFICIENT=.5,f.LIVE_TOUR_FULL_POWER_LIVE_COEFFICIENT=2,f.LIVE_ROYAL_DAMAGE_COEFFICIENT=.2,f.DREAM_LIVE_FESTIVAL_COMBO_LEVEL_COEFFICIENT=125,f.TALK_BATTLE_COMBO_LEVEL_COEFFICIENT=50,f}();!function(t){t[t.OWN=0]="OWN",t[t.RIVAL=1]="RIVAL"}(SKILL_TARGET_UNIT=SKILL_TARGET_UNIT||{}),function(t){t[t.SELF=0]="SELF",t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK",t[t.ALL=3]="ALL"}(SKILL_TARGET_MEMBER=SKILL_TARGET_MEMBER||{}),function(t){t[t.CUTE=1]="CUTE",t[t.COOL=2]="COOL",t[t.PASSION=4]="PASSION",t[t.ALL=7]="ALL"}(SKILL_TARGET_TYPE=SKILL_TARGET_TYPE||{}),function(t){t[t.ALL=0]="ALL",t[t.OFFENSE=1]="OFFENSE",t[t.DEFENSE=2]="DEFENSE"}(SKILL_TARGET_PARAM=SKILL_TARGET_PARAM||{});var CALCULATION_TYPE,SKILL_INPUT_MODE,ENABLE_SKILL_TYPE,Skill=function(){function t(t,e){this.target_unit=parseInt(t.target_unit),this.target_member=parseInt(t.target_member),this.target_type=parseInt(t.target_type),this.target_num=parseInt(t.target_num),this.target_param=parseInt(t.target_param),(this.value=0)<e&&(this.value=parseInt(t.skill_value_list[e-1]))}return t.prototype.check_skill_target=function(t){var e=!1;switch(this.target_member){case SKILL_TARGET_MEMBER.FRONT:for(var i=0;i<t[0].length;i++)if(0<(this.target_type&1<<i)&&0<t[0][i]){e=!0;break}break;case SKILL_TARGET_MEMBER.BACK:for(i=0;i<t[1].length;i++)if(0<(this.target_type&1<<i)&&0<t[1][i]){e=!0;break}break;case SKILL_TARGET_MEMBER.ALL:for(i=0;i<t.length;i++)for(var s=0;s<t[i].length;s++)if(0<(this.target_type&1<<s)&&0<t[i][s]){e=!0;break}}return e},t}(),UserPetitIdol=function(){function r(){this.type="0",this.vocal="0",this.dance="0",this.visual="0",this.status=0,ko.track(this)}return r.prototype.display_status=function(){return Math.ceil(this.status)},r.prototype.calculation=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=-1),void 0===i&&(i=-1);for(var s=parseInt(this.type),_=this.get_parameters(),a=0,l=0;l<_.length;l++)l==i&&(_[l]+=Math.ceil(_[l]*r.PARAMETER_BONUS_COEFFICIENT)),a+=_[l];s==e&&(a+=Math.ceil(a*r.TYPE_BONUS_COEFFICIENT)),a+=a*t/100,this.status=a},r.prototype.calculation_festival=function(t){var e=0;t&&(e=100*r.HIGH_TENSION_BONUS_COEFFICIENT),this.calculation(e)},r.prototype.calculation_live_royal=function(t,e,i,s){this.calculation(0,t,e);var _=this.status;_=Math.ceil(_*s),_*=i,this.status=_},r.prototype.get_parameters=function(){var t=[];t.push(parseInt(this.vocal)),t.push(parseInt(this.dance)),t.push(parseInt(this.visual));for(var e=0;e<t.length;e++)isNaN(t[e])&&(t[e]=0);return t},r.prototype.get_setting=function(){var t={};return t.type=this.type,t.vocal=this.vocal,t.dance=this.dance,t.visual=this.visual,t},r.prototype.set_setting=function(t){this.type=t.type,this.vocal=t.vocal,this.dance=t.dance,this.visual=t.visual},r.TYPE_BONUS_COEFFICIENT=.2,r.PARAMETER_BONUS_COEFFICIENT=.5,r.HIGH_TENSION_BONUS_COEFFICIENT=.1,r}();!function(t){t[t.NORMAL=0]="NORMAL",t[t.SURVIVAL=1]="SURVIVAL",t[t.FESTIVAL=2]="FESTIVAL",t[t.LIVE_TOUR=3]="LIVE_TOUR",t[t.SESSION=4]="SESSION",t[t.DREAM_LIVE_FESTIVAL=5]="DREAM_LIVE_FESTIVAL",t[t.ROYAL=6]="ROYAL",t[t.ROYAL_GUEST=7]="ROYAL_GUEST",t[t.TALK_BATTLE=8]="TALK_BATTLE",t[t.CHALLENGE=9]="CHALLENGE",t[t.FESTIVAL_S=10]="FESTIVAL_S"}(CALCULATION_TYPE=CALCULATION_TYPE||{}),function(t){t[t.MANUAL=0]="MANUAL",t[t.AUTO=1]="AUTO",t[t.AUTO_MEAN=2]="AUTO_MEAN"}(SKILL_INPUT_MODE=SKILL_INPUT_MODE||{}),function(t){t[t.ALL=0]="ALL",t[t.OFFENSE=1]="OFFENSE",t[t.DEFENSE=2]="DEFENSE"}(ENABLE_SKILL_TYPE=ENABLE_SKILL_TYPE||{});var BaseLiveCalcViewModel=function(){function s(){var e=this;this.calc_type=CALCULATION_TYPE.NORMAL.toString(),this.front_num="0",this.producer_type="-1",this.appeal_bonus=["0","0","0"],this.training_room_level="0",this.idol_list=[],this.petit_idol_list=[],this.skill_input_type="0",this.enable_skill_type="0",this.rival_front_num=["0","0","0"],this.rival_back_num=["0","0","0"],this.petit_idol_total_status=0,this.max_skill_invoke=0,this.skill_invocation_rate_list=[],this.save_data_key="",this.save_data_id="1",this.save_data_title="",this.code="",this.apply_code_url="",this.move_up=function(){var t=e.idol_list.indexOf(this);0<t&&e.idol_list.splice(t-1,2,e.idol_list[t],e.idol_list[t-1])},this.move_down=function(){var t=e.idol_list.indexOf(this);t<e.idol_list.length-1&&e.idol_list.splice(t,2,e.idol_list[t+1],e.idol_list[t])}}return s.prototype.actual_status=function(){return[0,0]},s.prototype.change_appeal_bonus=function(){ko.valueHasMutated(this,"appeal_bonus")},s.prototype.change_rival_front_num=function(){ko.valueHasMutated(this,"rival_front_num")},s.prototype.change_rival_back_num=function(){ko.valueHasMutated(this,"rival_back_num")},s.prototype.init_list=function(){this.init_idol_list(),this.init_petit_idol_list();var t=Common.get_param_list();t.code&&(this.code=t.code,this.apply_code())},s.prototype.init_idol_list=function(){},s.prototype.init_petit_idol_list=function(){for(var t=[],e=0;e<s.PETIT_IDOL_NUM;e++){var i=new UserPetitIdol;t.push(i)}this.petit_idol_list=t},s.prototype.calculation_petit_idol=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=-1),void 0===i&&(i=-1);for(var s=0,_=0;_<this.petit_idol_list.length;_++){var a=this.petit_idol_list[_];a.calculation(t,e,i),s+=a.status}return s},s.prototype.is_smartphone=function(){return Common.is_smartphone()},s.prototype.get_setting=function(){return{}},s.prototype.set_setting=function(t){},s.prototype.get_idol_setting=function(){for(var t=[],e=0;e<this.idol_list.length;e++)t.push(this.idol_list[e].get_setting());return t},s.prototype.set_idol_setting=function(s,_){var a=this;void 0===_&&(_=-1);for(var l=jQuery.Deferred(),t={},e=0;e<s.length;e++){var i="t"+s[e].type+"_r"+s[e].rarity;i in t||(t[i]={type:s[e].type,rarity:s[e].rarity})}var r=Object.keys(t),n=[];for(e=0;e<r.length;e++){var o=t[r[e]];n.push(Common.load_idol_list(parseInt(o.type),parseInt(o.rarity)))}return-1==_&&(_=s.length),jQuery.when.apply(null,n).done(function(){for(var t=[],e=0;e<s.length&&e<_;e++){(i=new UserIdol).set_setting(s[e]),t.push(i)}for(e=t.length;e<_;e++){var i=new UserIdol;t.push(i)}a.idol_list=t,l.resolve()}),l.promise()},s.prototype.get_appeal_bonus_setting=function(){for(var t=[],e=0;e<this.appeal_bonus.length;e++){var i={};i.type=e.toString(),i.value=this.appeal_bonus[e],t.push(i)}return t},s.prototype.set_appeal_bonus_setting=function(t){if(null!=t){for(var e=this.appeal_bonus,i=0;i<t.length;i++)if(null!=t[i]){var s=t[i];e[s.type]=s.value.toString()}this.appeal_bonus=e,this.change_appeal_bonus()}},s.prototype.get_rival_member_setting=function(){for(var t={front:[]},e=0;e<this.rival_front_num.length;e++){(i={}).type=e.toString(),i.value=this.rival_front_num[e],t.front.push(i)}t.back=[];for(e=0;e<this.rival_back_num.length;e++){var i;(i={}).type=e.toString(),i.value=this.rival_back_num[e],t.back.push(i)}return t},s.prototype.set_rival_member_setting=function(t){if(null!=t){if(null!=t.front){for(var e=this.rival_front_num,i=0;i<t.front.length;i++){if(null!=t.front[i])e[(_=t.front[i]).type]=_.value.toString()}this.rival_front_num=e,this.change_rival_front_num()}if(null!=t.back){var s=this.rival_back_num;for(i=0;i<t.back.length;i++){var _;if(null!=t.back[i])s[(_=t.back[i]).type]=_.value.toString()}this.rival_back_num=s,this.change_rival_back_num()}}},s.prototype.get_petit_idol_setting=function(){for(var t=[],e=0;e<this.petit_idol_list.length;e++)t.push(this.petit_idol_list[e].get_setting());return t},s.prototype.set_petit_idol_setting=function(t,e){if(null!=t){for(var i=[],s=0;s<t.length&&s!=e;s++){var _=new UserPetitIdol;_.set_setting(t[s]),i.push(_)}this.petit_idol_list=i}},s.prototype.save_setting=function(){try{var t=this.save_data_key+"_title_"+this.save_data_id;localStorage.setItem(t,this.save_data_title),t=this.save_data_key+"_"+this.save_data_id,localStorage.setItem(t,JSON.stringify(this.get_setting()))}catch(t){console.log(t.message),alert("データ保存時にエラーが発生しました。")}},s.prototype.load_setting=function(){var t=this.save_data_key+"_title_"+this.save_data_id,e=localStorage.getItem(t);t=this.save_data_key+"_"+this.save_data_id;var i=localStorage.getItem(t);if(null!=i){null==e&&(e="");var s=JSON.parse(i);this.save_data_title=e,this.set_setting(s)}else alert("データが保存されていません。")},s.prototype.generate_code=function(){var t=this.get_setting(),e=JSON.stringify(t);try{var i=Common.get_compress_data(e),s=Common.get_page_url()+"?code="+i;this.code=i,this.apply_code_url=s}catch(t){console.log(t.message),alert("コードの生成に失敗しました。")}},s.prototype.apply_code=function(){try{var t=Common.get_decompress_data(this.code),e=JSON.parse(t),i=Common.get_page_url()+"?code="+this.code;this.set_setting(e),this.apply_code_url=i}catch(t){console.log(t.message),alert("コードの適用に失敗しました。")}},s.prototype.is_skill_input_type_manual=function(){return parseInt(this.skill_input_type)==SKILL_INPUT_MODE.MANUAL},s.prototype.calc_skill_value=function(){var _=this;if(!this.is_skill_input_type_manual()){for(var t=0;t<this.idol_list.length;t++){var e=this.idol_list[t];e.offense_skill="0",e.defense_skill="0",e.enable_skill=!1}this.get_invoke_skill_list().done(function(t){for(var e=parseInt(_.front_num),i=0;i<_.idol_list.length;i++){var s=i<e;_.apply_skill_effect(_.idol_list[i],s,t)}})}},s.prototype.get_invoke_skill_list=function(){for(var l=this,r=parseInt(this.front_num),n=[[0,0,0],[0,0,0]],t=0;t<this.idol_list.length;t++){var e=parseInt(this.idol_list[t].type);t<r?n[0][e]++:n[1][e]++}var o=[[0,0,0],[0,0,0]];for(t=0;t<this.rival_front_num.length;t++)o[0][t]=parseInt(this.rival_front_num[t]);for(t=0;t<this.rival_back_num.length;t++)o[1][t]=parseInt(this.rival_back_num[t]);var c=jQuery.Deferred();return Common.load_skill_list().done(function(t){for(var e=[],i=parseInt(l.skill_input_type),s=0;s<l.idol_list.length&&s<r;s++){var _=l.idol_list[s],a=l.get_invoke_skill(_,t,n,o,e.length);if(null!=a&&(e.push(a),i!=SKILL_INPUT_MODE.AUTO_MEAN&&e.length>=l.max_skill_invoke))break}c.resolve(e)}),c.promise()},s.prototype.get_invoke_skill=function(t,e,i,s,_){if(0==parseInt(t.skill_id)||0==parseInt(t.skill_level))return null;var a=this.get_skill(t,e);return null==a?null:this.check_skill_enable(a,i,s)?(t.enable_skill=!0,this.correct_skill_value(a,_),a.target_member==SKILL_TARGET_MEMBER.SELF&&this.apply_skill_value(t,a),a):null},s.prototype.get_skill=function(t,e){var i=jQuery.extend(!0,{},e[t.skill_id]);return null==i.skill_value_list||0==i.skill_value_list.length?null:new Skill(i,parseInt(t.skill_level))},s.prototype.check_skill_enable=function(t,e,i){return t.target_unit==SKILL_TARGET_UNIT.OWN?this.check_target_own_unit_skill_enable(t,e):this.check_target_rival_unit_skill_enable(t,i)},s.prototype.check_target_own_unit_skill_enable=function(t,e){var i=parseInt(this.enable_skill_type);return(i==ENABLE_SKILL_TYPE.ALL||t.target_param==SKILL_TARGET_PARAM.ALL||i==t.target_param)&&(t.target_member==SKILL_TARGET_MEMBER.SELF||t.check_skill_target(e))},s.prototype.check_target_rival_unit_skill_enable=function(t,e){var i=parseInt(this.enable_skill_type);return i==ENABLE_SKILL_TYPE.ALL||0<(i^t.target_param)},s.prototype.correct_skill_value=function(t,e){if(parseInt(this.skill_input_type)==SKILL_INPUT_MODE.AUTO_MEAN){var i=this.skill_invocation_rate_list[e];null!=i&&(t.value*=i/100)}},s.prototype.apply_skill_effect=function(t,e,i){for(var s=0;s<i.length;s++){var _=i[s];if(this.check_apply_skill(t,_))switch(_.target_member){case SKILL_TARGET_MEMBER.SELF:break;case SKILL_TARGET_MEMBER.FRONT:e&&this.apply_skill_value(t,_);break;case SKILL_TARGET_MEMBER.BACK:!e&&(-1==_.target_num||0<_.target_num)&&(this.apply_skill_value(t,_),_.target_num--);break;case SKILL_TARGET_MEMBER.ALL:e?this.apply_skill_value(t,_):(-1==_.target_num||0<_.target_num)&&(this.apply_skill_value(t,_),_.target_num--)}}},s.prototype.apply_skill_value=function(t,e){var i=parseFloat(t.offense_skill),s=parseFloat(t.defense_skill);switch(e.target_param){case SKILL_TARGET_PARAM.ALL:i+=e.value,s+=e.value;break;case SKILL_TARGET_PARAM.OFFENSE:i+=e.value;break;case SKILL_TARGET_PARAM.DEFENSE:s+=e.value}t.offense_skill=i.toString(),t.defense_skill=s.toString()},s.prototype.check_apply_skill=function(t,e){var i=!1,s=parseInt(t.type);return e.target_unit==SKILL_TARGET_UNIT.OWN&&(e.target_member==SKILL_TARGET_MEMBER.SELF||0<(e.target_type&1<<s))&&(i=!0),i},s.PETIT_IDOL_NUM=3,s}(),__extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},DamageValue=function(){function t(t){void 0===t&&(t=0),this.value=t}return t.prototype.get_turn_damage=function(){return Math.ceil(this.value)},t.prototype.get_battle_damage=function(){return this.get_turn_damage()*t.BATTLE_DAMAGE_COEFFICIENT},t.BATTLE_DAMAGE_COEFFICIENT=5,t}(),Damage=function(){function e(t,e){void 0===t&&(t=""),void 0===e&&(e=0),this.name=t,this.min=new DamageValue(e),this.max=new DamageValue(e),this.avg=new DamageValue(e)}return e.prototype.add_damage=function(t){this.min.value+=Math.ceil(t*e.COEFFICIENT_MIN*10)/10,this.max.value+=Math.ceil(t*e.COEFFICIENT_MAX*10)/10,this.avg.value+=Math.ceil(t*e.COEFFICIENT_AVG*10)/10},e.prototype.add_bonus=function(t){this.min.value+=t,this.max.value+=t,this.avg.value+=t},e.COEFFICIENT_MIN=.97,e.COEFFICIENT_MAX=1.02,e.COEFFICIENT_AVG=.995,e}(),BaseLiveTourCalcViewModel=function(t){function e(){t.call(this),this.max_member_num=20,this.front_num="10",this.voltage_bonus="0",this.petit_idol_bonus_type="-1",this.petit_idol_bonus_parameter="-1",this.max_skill_invoke=5,this.skill_invocation_rate_list=[100,50,37.5,29.6875,24.51171875,20.880126953125,18.195724487304688,16.121602058410645,14.460162818431854,13.09043737128377],this.front_offense=0,this.front_defense=0,this.back_offense=0,this.back_defense=0,this.damage_list=[]}return __extends(e,t),e.prototype.init_idol_list=function(){for(var t=this.max_member_num,e=[],i=this.idol_list,s=0;s<i.length;s++)e.push(i[s].get_setting());var _=[];for(s=0;s<t;s++){var a=new UserIdol;null!=e[s]&&a.set_setting(e[s]),_.push(a)}this.idol_list=_},e.prototype.get_setting=function(){var t={};return t.producer_type=this.producer_type,t.appeal_bonus=this.get_appeal_bonus_setting(),t.training_room_level=this.training_room_level,t.petit_idol_bonus_type=this.petit_idol_bonus_type,t.petit_idol_bonus_parameter=this.petit_idol_bonus_parameter,t.calc_type=this.calc_type,t.skill_input_type=this.skill_input_type,t.enable_skill_type=this.enable_skill_type,t.rival_member=this.get_rival_member_setting(),t.idol=this.get_idol_setting(),t.petit_idol=this.get_petit_idol_setting(),t},e.prototype.set_setting=function(t){this.producer_type=t.producer_type,this.set_appeal_bonus_setting(t.appeal_bonus),this.training_room_level=t.training_room_level,this.petit_idol_bonus_type=t.petit_idol_bonus_type,this.petit_idol_bonus_parameter=t.petit_idol_bonus_parameter,this.calc_type=t.calc_type,this.enable_skill_type=t.enable_skill_type,this.set_rival_member_setting(t.rival_member),this.set_idol_setting(t.idol,this.max_member_num),this.set_petit_idol_setting(t.petit_idol,BaseLiveCalcViewModel.PETIT_IDOL_NUM)},e.prototype.check_target_rival_unit_skill_enable=function(t,e){var i=parseInt(this.enable_skill_type);if(i!=ENABLE_SKILL_TYPE.ALL&&0==(i^t.target_param))return!1;if(t.target_member!=SKILL_TARGET_MEMBER.FRONT&&t.target_member!=SKILL_TARGET_MEMBER.ALL)return!1;if(t.check_skill_target(e)){switch(t.target_param){case SKILL_TARGET_PARAM.OFFENSE:t.target_param=SKILL_TARGET_PARAM.DEFENSE;break;case SKILL_TARGET_PARAM.DEFENSE:t.target_param=SKILL_TARGET_PARAM.OFFENSE}t.target_member=SKILL_TARGET_MEMBER.FRONT}else t.value=0;return!0},e.prototype.check_apply_skill=function(t,e){var i=!1,s=parseInt(t.type);return e.target_unit==SKILL_TARGET_UNIT.OWN?(e.target_member==SKILL_TARGET_MEMBER.SELF||0<(e.target_type&1<<s))&&(i=!0):e.target_unit==SKILL_TARGET_UNIT.RIVAL&&(i=!0),i},e}(BaseLiveCalcViewModel),ViewModel=function(_){function i(){_.call(this),this.calc_type=CALCULATION_TYPE.ROYAL.toString(),this.battle_point="2",this.save_data_key="imas_cg_live_royal_calc",this.init_list(),ko.track(this)}return __extends(i,_),i.prototype.actual_status=function(){return this.calculation()},i.prototype.is_guest_live=function(){return parseInt(this.calc_type)==CALCULATION_TYPE.ROYAL_GUEST},i.prototype.calculation=function(){this.calc_skill_value();for(var t=this.get_battle_point_rate(),e=parseInt(this.front_num),i=parseInt(this.producer_type),s=parseFloat(this.voltage_bonus),_=parseInt(this.training_room_level),a=this.is_guest_live(),l=0,r=0,n=new Damage,o=0,c=0,p=0,h=0,u=0;u<this.idol_list.length;u++){var f=this.idol_list[u],v=u<e;f.calculation_live_royal(v,a,i,this.appeal_bonus,s,t,_);var E=f.actual_offense,d=f.actual_defense;v?(o+=E,c+=d):(p+=E,h+=d),l+=E,r+=d,a&&n.add_damage(f.calc_live_royal_damage()),f.style="numeric "+(v?"front":"back")}this.front_offense=o,this.front_defense=c,this.back_offense=p,this.back_defense=h;var I=this.calculation_royal_petit_idol(s,t);return n.add_bonus(Math.floor(I*UserIdol.LIVE_ROYAL_DAMAGE_COEFFICIENT)),l+=I,r+=I,this.petit_idol_total_status=I,this.damage_list=[n],[l,r]},i.prototype.calculation_royal_petit_idol=function(t,e){for(var i=parseInt(this.petit_idol_bonus_type),s=parseInt(this.petit_idol_bonus_parameter),_=0,a=0;a<this.petit_idol_list.length;a++){var l=this.petit_idol_list[a];l.calculation_live_royal(i,s,e,t),_+=l.status}return Math.ceil(_)},i.prototype.get_battle_point_rate=function(){var t=parseInt(this.battle_point),e=i.BATTLE_POINT_RATE_LIST[t-1];return this.is_guest_live()&&(e=i.GUEST_BATTLE_POINT_RATE_LIST[t-1]),e},i.prototype.get_setting=function(){var t=_.prototype.get_setting.call(this);return t.battle_point=this.battle_point,t.voltage_bonus=this.voltage_bonus,t},i.prototype.set_setting=function(t){_.prototype.set_setting.call(this,t),this.battle_point=t.battle_point,this.voltage_bonus=t.voltage_bonus},i.prototype.check_target_rival_unit_skill_enable=function(t,e){if(this.is_guest_live())return _.prototype.check_target_rival_unit_skill_enable.call(this,t,e);var i=parseInt(this.enable_skill_type);return i==ENABLE_SKILL_TYPE.ALL||0<(i^t.target_param)},i.prototype.check_apply_skill=function(t,e){if(this.is_guest_live())return _.prototype.check_apply_skill.call(this,t,e);var i=!1,s=parseInt(t.type);return e.target_unit==SKILL_TARGET_UNIT.OWN&&(e.target_member==SKILL_TARGET_MEMBER.SELF||0<(e.target_type&1<<s))&&(i=!0),i},i.BATTLE_POINT_RATE_LIST=[.8,1,1.5,2,2.5],i.GUEST_BATTLE_POINT_RATE_LIST=[.5,1,1.6,2.25,3],i}(BaseLiveTourCalcViewModel);jQuery(function(){ko.applyBindings(new ViewModel)});