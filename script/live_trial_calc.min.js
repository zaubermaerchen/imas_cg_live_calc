var SKILL_TARGET_UNIT,SKILL_TARGET_MEMBER,SKILL_TARGET_TYPE,SKILL_TARGET_PARAM,Common=function(){function t(){}return t.load_idol_list=function(t,e,s){var i=this;void 0===s&&(s=[]);var a=this.IDOL_LIST_KEY_BASE;-1==t&&-1==e?a+="_all":(-1!=t&&(a+="_t"+t),-1!=e&&(a+="_r"+e));var _=this.cache_data[a],l=jQuery.Deferred();if(null!=_)l.resolve(JSON.parse(_));else{var o={};-1!=t&&(o.type=t),-1!=e&&(o.rarity=e),0<s.length&&(o.fields=s.join(" ")),jQuery.post(this.IDOL_DATA_API_URL,o,function(t){i.cache_data[a]=JSON.stringify(t.results),l.resolve(t.results)},"json")}return l.promise()},t.load_skill_list=function(){var e=this,s=this.SKILL_LIST_KEY,t=this.cache_data[s],i=jQuery.Deferred();return null!=t?i.resolve(JSON.parse(t)):jQuery.post(this.SKILL_DATA_API_URL,function(t){e.cache_data[s]=JSON.stringify(t),i.resolve(t)},"json"),i.promise()},t.get_compress_data=function(t){for(var e=[],s=0;s<t.length;s++){var i=t.charCodeAt(s),a=parseInt(i.toString(),10);e.push(a)}var _=new Zlib.Deflate(e).compress(),l="";for(s=0;s<_.length;s++)l+=("0"+_[s].toString(16)).slice(-2);return l},t.get_decompress_data=function(t){for(var e=[],s=0;s<t.length;s+=2)e.push(parseInt(t.substr(s,2),16));var i=new Zlib.Inflate(e).decompress(),a="";for(s=0;s<i.length;s++)a+=String.fromCharCode(i[s]);return a},t.get_param_list=function(){var t={},e=location.href.indexOf("?");if(-1<e)for(var s=location.href.slice(e+1).split("&"),i=0;i<s.length;i++){var a=s[i].split("=");a[1]&&(t[a[0]]=a[1])}return t},t.get_page_url=function(){var t=location.href,e=t.indexOf("?");return-1<e&&(t=t.slice(0,e)),t},t.get_qrcode_url=function(t,e){void 0===e&&(e=150);var s=[];return s.push("chs="+e+"x"+e),s.push("cht=qr"),s.push("chl="+t),this.GOOGLE_CHART_API_URL+"?"+s.join("&")},t.to_int=function(t){return t.match(/^[-+]?[0-9]+$/)||(t="0"),parseInt(t,10)},t.is_smartphone=function(){return null!=navigator.userAgent.match(/(Android|iPhone|iPad|Mobile)/g)},t.IDOL_DATA_API_URL="https://zaubermaerchen.info/imas_cg/api/idol/list/",t.IDOL_LIST_KEY_BASE="imas_cg_idol_list",t.SKILL_DATA_API_URL="https://zaubermaerchen.info/imas_cg/api/skill/list/",t.SKILL_LIST_KEY="imas_cg_skill_list",t.GOOGLE_CHART_API_URL="https://chart.apis.google.com/chart",t.cache_data={},t}(),UserIdol=function(){function f(){this.id="0",this.type="0",this.rarity="0",this.cost="0",this.offense="0",this.defense="0",this.event_power="1",this.accessories_power="1",this.offense_skill="0",this.defense_skill="0",this.skill_id="0",this.skill_level="10",this.skill_name="無し",this.is_festival=!1,this.is_survival=!1,this.enable_skill=!1,this.actual_offense=0,this.actual_defense=0,this.style="numeric",this.idol_data_list=[],this.skill_data_list=[],this.set_idol_list(),this.set_skill_list(),ko.track(this)}return f.prototype.display_offense=function(){return Math.ceil(this.actual_offense)},f.prototype.display_defense=function(){return Math.ceil(this.actual_defense)},f.prototype.status=function(){return parseInt(this.offense)+parseInt(this.defense)},f.prototype.offense_per_cost=function(){return this.calc_cost_ratio(parseInt(this.offense))},f.prototype.defense_per_cost=function(){return this.calc_cost_ratio(parseInt(this.defense))},f.prototype.status_per_cost=function(){return this.calc_cost_ratio(this.status())},f.prototype.select_idol_list=function(){return this.idol_data_list},f.prototype.select_skill_list=function(){return this.skill_data_list},f.prototype.get_cost=function(){var t=parseInt(this.cost);return this.is_festival&&t==f.TRAINER_COST&&(t=5),t},f.prototype.calc_cost_ratio=function(t){var e=parseInt(this.cost),s=0;return 0<e&&(s=Math.round(t/e*100)/100),s},f.prototype.get_cost_corrected_status=function(t,e,s){if(s<e){var i=s/e;t=(this.is_survival||this.is_festival||(i=Math.ceil(10*i)/10),Math.ceil(t*i))}return t},f.prototype.set_idol_list=function(){var e=this,s=jQuery.Deferred(),t=parseInt(this.type),i=parseInt(this.rarity);return jQuery.when(this.load_idol_list(t,i)).done(function(t){e.set_select_idol_list(t),e.id="0",e.cost="0",e.offense="0",e.defense="0",e.offense_skill="0",e.defense_skill="0",e.skill_level="10",e.set_skill_info(null),s.resolve()}),s.promise()},f.prototype.set_select_idol_list=function(t){var e=[];for(var s in e.push({id:"0",name:"-"}),t)if(t.hasOwnProperty(s)){var i=t[s];e.push({id:i.idol_id,name:i.name})}this.idol_data_list=e},f.prototype.set_skill_list=function(){var a=this,_=jQuery.Deferred();return jQuery.when(Common.load_skill_list()).done(function(t){var e=[];for(var s in e.push({id:"0",name:"-"}),t)if(t.hasOwnProperty(s)){var i=t[s];e.push({id:i.skill_id,name:i.comment})}a.skill_data_list=e,_.resolve()}),_.promise()},f.prototype.change_idol=function(){var s=this,t=parseInt(this.type),e=parseInt(this.rarity),i=parseInt(this.id);this.offense_skill="0",this.defense_skill="0",isNaN(i)||0==i?(this.cost="0",this.offense="0",this.defense="0",this.set_skill_info(null)):jQuery.when(this.load_idol_list(t,e)).done(function(t){var e=t[s.id];s.cost=e.cost,s.offense=e.max_offense,s.defense=e.max_defense,s.set_skill_info(e)})},f.prototype.set_skill_info=function(t){var e="0",s="無し";null!=t&&(e=t.skill_id,null!=t.skill_name&&""!=t.skill_name&&(s=t.skill_name)),this.skill_name=s,this.skill_id=e},f.prototype.get_setting=function(){var t={};return t.type=this.type,t.rarity=this.rarity,t.id=this.id,t.cost=this.cost,t.offense=this.offense,t.defense=this.defense,t.event_power=this.event_power,t.accessories_power=this.accessories_power,t.offense_skill=this.offense_skill,t.defense_skill=this.defense_skill,t.skill_id=this.skill_id,t.skill_level=this.skill_level,t},f.prototype.set_setting=function(e){var s=this;this.type=e.type,this.rarity=e.rarity,jQuery.when(this.load_idol_list(parseInt(e.type),parseInt(e.rarity))).done(function(t){s.set_select_idol_list(t),s.id=e.id,null!=e.cost&&(s.cost=e.cost),s.offense=e.offense,s.defense=e.defense,s.event_power=e.event_power,e.accessories_power&&(s.accessories_power=e.accessories_power),s.offense_skill=e.offense_skill,s.defense_skill=e.defense_skill,s.set_skill_setting(t[e.id],e.skill_id,e.skill_level)})},f.prototype.set_skill_setting=function(t,e,s){var i=this;this.set_skill_info(t),this.skill_level=s,jQuery.when(Common.load_skill_list()).done(function(t){t.hasOwnProperty(e)&&(i.skill_id=e)})},f.prototype.get_type_ratio=function(t,e){var s=parseInt(this.type),i=0;return i+=s==t?f.PRODUCER_TYPE_COEFFICIENT:parseInt(e[s])/100},f.prototype.load_idol_list=function(t,e){var s=jQuery.Deferred();return jQuery.when(Common.load_idol_list(t,e,["type","rarity","name","cost","max_offense","max_defense","skill_name","skill_id"])).done(function(t){s.resolve(t)}),s.promise()},f.prototype.calculation=function(t,e,s,i,a,_,l){var o=0,r=0;if(!t||1<=e){var n=parseInt(this.offense),c=parseInt(this.defense),h=parseFloat(this.offense_skill),p=parseFloat(this.defense_skill);r=s?(o=this.calc_front_status(n,h,t,e,i,a,_,l),this.calc_front_status(c,p,t,e,i,a,_,l)):(o=this.calc_back_status(n,h,t,e),this.calc_back_status(c,p,t,e))}this.actual_offense=o,this.actual_defense=r},f.prototype.calculation_festival=function(t,e,s,i,a,_,l,o,r,n){var c=parseInt(this.offense),h=parseInt(this.defense),p=parseFloat(this.offense_skill),u=parseFloat(this.defense_skill),f=0,d=0;d=s?(f=this.calc_festival_front_status(c,p,t,e,i,a,_,l,o,r,n),this.calc_festival_front_status(h,u,t,e,i,a,_,l,o,r,-1)):(f=this.calc_back_status(c,p,t,e),this.calc_back_status(h,u,t,e)),this.actual_offense=f,this.actual_defense=d},f.prototype.calc_front_status=function(t,e,s,i,a,_,l,o){s&&(t=this.get_cost_corrected_status(t,this.get_cost(),i));for(var r=parseInt(this.type),n=0;n<l.length;n++)if(r==parseInt(l[n])){t=Math.ceil(t*(1+f.INSTITUTION_COEFFICIENT));break}var c=1+this.get_type_ratio(a,_)+(o+e)/100;return t=Math.ceil(t*c)},f.prototype.calc_back_status=function(t,e,s,i){var a=this.get_cost(),_=Math.ceil(t*f.BACK_MEMBER_COEFFICIENT);s&&(_=this.get_cost_corrected_status(_,a,i));var l=1+e/100;return _=Math.floor(_*l*10)/10},f.prototype.calc_festival_front_status=function(t,e,s,i,a,_,l,o,r,n,c){s&&(t=this.get_cost_corrected_status(t,this.get_cost(),i));for(var h=parseInt(this.type),p=0;p<l.length;p++)if(h==parseInt(l[p])){t=Math.ceil(t*(1+f.INSTITUTION_COEFFICIENT));break}var u=1+this.get_type_ratio(a,_)+(e+r)/100;return t=Math.ceil(t*u),t*=u=1+o/100,u=1,h==c&&(u+=f.GROOVE_BONUS_COEFFICIENT),t=Math.round(t*u),u=1,n&&(u+=f.HIGH_TENSION_BONUS_COEFFICIENT),t=Math.round(t*u)},f.prototype.calculation_survival=function(t,e){this.is_survival=!0;var s=Math.floor(parseInt(this.offense)*parseFloat(this.event_power));t&&(s=this.get_cost_corrected_status(s,this.get_cost(),e)),this.actual_offense=s},f.prototype.calculation_live_tour=function(t,e,s,i){var a=parseInt(this.offense),_=parseInt(this.defense),l=parseFloat(this.offense_skill),o=parseFloat(this.defense_skill),r=0,n=0;n=t?(r=this.calc_live_tour_front_status(a,l,e,s,i),this.calc_live_tour_front_status(_,o,e,s,i)):(r=this.calc_live_tour_back_status(a,l),this.calc_live_tour_back_status(_,o)),this.actual_offense=r,this.actual_defense=n},f.prototype.calc_live_tour_front_status=function(t,e,s,i,a){var _=Math.ceil(t*parseFloat(this.accessories_power));_=Math.floor(_*parseFloat(this.event_power));var l=1+this.get_type_ratio(s,i)+(e+a)/100;return _=Math.ceil(_*l)},f.prototype.calc_live_tour_back_status=function(t,e){var s=Math.floor(t*parseFloat(this.event_power));s=Math.ceil(s*f.BACK_MEMBER_COEFFICIENT);var i=1+e/100;return s=Math.ceil(s*i)},f.prototype.calculation_dream_live_festival=function(t,e,s,i,a,_){var l=parseInt(this.offense),o=parseInt(this.defense),r=parseFloat(this.offense_skill),n=parseFloat(this.defense_skill),c=0,h=0;h=t?(c=this.calc_dream_live_festival_front_status(l,r,e,s,i,a,_),this.calc_dream_live_festival_front_status(o,n,e,s,i,a,_)):(c=this.calc_dream_live_festival_back_status(l,r,a),this.calc_dream_live_festival_back_status(o,n,a)),this.actual_offense=c,this.actual_defense=h},f.prototype.calc_dream_live_festival_front_status=function(t,e,s,i,a,_,l){var o=Math.floor(t*parseFloat(this.event_power)),r=1+_/100;return o=Math.floor(o*r),r=1+this.get_type_ratio(s,i)+(e+l)/100,o=Math.ceil(o*r),r=1,r+=Math.sqrt(f.DREAM_LIVE_FESTIVAL_COMBO_LEVEL_COEFFICIENT*a)/100,o=Math.ceil(o*r)},f.prototype.calc_dream_live_festival_back_status=function(t,e,s){var i=Math.floor(t*parseFloat(this.event_power));i=Math.ceil(i*f.BACK_MEMBER_COEFFICIENT);var a=1+s/100;return i=Math.floor(i*a),a=1+e/100,i=Math.ceil(i*a)},f.prototype.calculation_live_royal=function(t,e,s,i,a,_,l){var o=parseInt(this.offense),r=parseInt(this.defense),n=parseFloat(this.offense_skill),c=parseFloat(this.defense_skill),h=0,p=0;p=t?(h=this.calc_live_royal_front_status(o,n,e,s,i,a,_,l),this.calc_live_royal_front_status(r,c,e,s,i,a,_,l)):(h=this.calc_live_royal_back_status(o,n,e,a,_),this.calc_live_royal_back_status(r,c,e,a,_)),this.actual_offense=h,this.actual_defense=p},f.prototype.calc_live_royal_front_status=function(t,e,s,i,a,_,l,o){var r=1;s&&(r=parseFloat(this.event_power));var n=Math.ceil(t*r);return n*=_,n*=l,n*=1+this.get_type_ratio(i,a)+(e+o)/100,n=Math.round(10*n)/10,Math.ceil(n)},f.prototype.calc_live_royal_back_status=function(t,e,s,i,a){var _=1;s&&(_=parseFloat(this.event_power));var l=Math.ceil(t*_);return l=Math.ceil(l*f.BACK_MEMBER_COEFFICIENT),l*=i,l*=a,l*=1+e/100,l=Math.round(10*l)/10,Math.ceil(l)},f.prototype.calc_live_royal_damage=function(){return Math.floor(this.actual_offense)*f.LIVE_ROYAL_DAMAGE_COEFFICIENT},f.prototype.calculation_live_trial=function(t,e,s,i){var a=parseInt(this.offense),_=parseInt(this.defense),l=parseFloat(this.offense_skill),o=parseFloat(this.defense_skill),r=0,n=0;n=s?(r=this.calc_live_trial_front_status(a,l,t,e,i),this.calc_live_trial_front_status(_,o,t,e,i)):(r=this.calc_live_trial_back_status(a,l,t,e),this.calc_live_trial_back_status(_,o,t,e)),this.actual_offense=r,this.actual_defense=n},f.prototype.calc_live_trial_front_status=function(t,e,s,i,a){var _=this.get_cost();s&&(t=this.get_cost_corrected_status(t,_,i));var l=1;return parseInt(this.type)==a&&(l+=f.PRODUCER_TYPE_COEFFICIENT),l+=e/100,t=Math.ceil(t*l)},f.prototype.calc_live_trial_back_status=function(t,e,s,i){var a=this.get_cost(),_=Math.floor(t*f.BACK_MEMBER_COEFFICIENT),l=_;if(s&&(l=this.get_cost_corrected_status(l,a,i),i<a&&(l*=f.BACK_MEMBER_COEFFICIENT)),!s||a<=i){var o=e/100;l=Math.floor(l)+Math.ceil(_*o*10)/10}return Math.floor(l)},f.prototype.calculation_talk_battle=function(t,e,s,i,a,_){var l=parseInt(this.offense),o=parseInt(this.defense),r=parseFloat(this.offense_skill),n=parseFloat(this.defense_skill),c=0,h=0;h=t?(c=this.calc_talk_battle_front_status(l,r,e,s,i,a,_),this.calc_talk_battle_front_status(o,n,e,s,i,a,_)):(c=this.calc_talk_battle_back_status(l,r,i,a),this.calc_talk_battle_back_status(o,n,i,a)),this.actual_offense=c,this.actual_defense=h},f.prototype.calc_talk_battle_front_status=function(t,e,s,i,a,_,l){var o=Math.floor(t*parseFloat(this.event_power)),r=1+this.get_type_ratio(s,i);return o=Math.ceil(o*r),r=1+e/100,o=Math.round(o*r),r=1+l/100,o=Math.round(o*r),r=1+Math.sqrt(f.TALK_BATTLE_COMBO_LEVEL_COEFFICIENT*a)/100,o=Math.round(o*r),r=1+_/100,o=Math.ceil(o*r)},f.prototype.calc_talk_battle_back_status=function(t,e,s,i){var a=Math.floor(t*parseFloat(this.event_power));a=Math.ceil(a*f.BACK_MEMBER_COEFFICIENT);var _=1+e/100;return a=Math.round(a*_),_=1+Math.sqrt(f.TALK_BATTLE_COMBO_LEVEL_COEFFICIENT*s)/100,a=Math.round(a*_),_=1+i/100,a=Math.ceil(a*_)},f.prototype.calculation_challenge=function(t,e,s,i,a,_){var l=parseInt(this.offense),o=parseInt(this.defense),r=parseFloat(this.offense_skill),n=parseFloat(this.defense_skill),c=0,h=0;h=t?(c=this.calc_challenge_front_status(l,r,e,s,i,a,_),this.calc_challenge_front_status(o,n,e,s,i,a,_)):(c=this.calc_challenge_back_status(l,r,i),this.calc_challenge_back_status(o,n,i)),this.actual_offense=c,this.actual_defense=h},f.prototype.calc_challenge_front_status=function(t,e,s,i,a,_,l){var o=parseFloat(this.event_power);parseInt(this.type)==a&&(o*=2);var r=Math.floor(t*o);return o=1+_/100,r=Math.floor(r*o),o=1+this.get_type_ratio(s,i),r=Math.ceil(r*o),o=1+e/100,r=Math.round(r*o),o=1+l/100,r=Math.round(r*o)},f.prototype.calc_challenge_back_status=function(t,e,s){var i=parseFloat(this.event_power);parseInt(this.type)==s&&(i*=2);var a=Math.floor(t*i);return a=Math.ceil(a*f.BACK_MEMBER_COEFFICIENT),i=1+e/100,a=Math.round(a*i)},f.prototype.calc_challenge_damage=function(){return Math.floor(this.actual_offense)/5},f.TRAINER_COST=999,f.PRODUCER_TYPE_COEFFICIENT=.05,f.INSTITUTION_COEFFICIENT=.05,f.BACK_MEMBER_COEFFICIENT=.8,f.HIGH_TENSION_BONUS_COEFFICIENT=.1,f.COMPATIBILITY_BONUS_COEFFICIENT=.2,f.GROOVE_BONUS_COEFFICIENT=.2,f.LIVE_TOUR_NORMAL_LIVE_COEFFICIENT=.5,f.LIVE_TOUR_FULL_POWER_LIVE_COEFFICIENT=2,f.LIVE_ROYAL_DAMAGE_COEFFICIENT=.2,f.DREAM_LIVE_FESTIVAL_COMBO_LEVEL_COEFFICIENT=125,f.TALK_BATTLE_COMBO_LEVEL_COEFFICIENT=50,f}();!function(t){t[t.OWN=0]="OWN",t[t.RIVAL=1]="RIVAL"}(SKILL_TARGET_UNIT=SKILL_TARGET_UNIT||{}),function(t){t[t.SELF=0]="SELF",t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK",t[t.ALL=3]="ALL"}(SKILL_TARGET_MEMBER=SKILL_TARGET_MEMBER||{}),function(t){t[t.CUTE=1]="CUTE",t[t.COOL=2]="COOL",t[t.PASSION=4]="PASSION",t[t.ALL=7]="ALL"}(SKILL_TARGET_TYPE=SKILL_TARGET_TYPE||{}),function(t){t[t.ALL=0]="ALL",t[t.OFFENSE=1]="OFFENSE",t[t.DEFENSE=2]="DEFENSE"}(SKILL_TARGET_PARAM=SKILL_TARGET_PARAM||{});var CALCULATION_TYPE,SKILL_INPUT_MODE,ENABLE_SKILL_TYPE,Skill=function(){function t(t,e){this.target_unit=parseInt(t.target_unit),this.target_member=parseInt(t.target_member),this.target_type=parseInt(t.target_type),this.target_num=parseInt(t.target_num),this.target_param=parseInt(t.target_param),(this.value=0)<e&&(this.value=parseInt(t.skill_value_list[e-1]))}return t.prototype.check_skill_target=function(t){var e=!1;switch(this.target_member){case SKILL_TARGET_MEMBER.FRONT:for(var s=0;s<t[0].length;s++)if(0<(this.target_type&1<<s)&&0<t[0][s]){e=!0;break}break;case SKILL_TARGET_MEMBER.BACK:for(s=0;s<t[1].length;s++)if(0<(this.target_type&1<<s)&&0<t[1][s]){e=!0;break}break;case SKILL_TARGET_MEMBER.ALL:for(s=0;s<t.length;s++)for(var i=0;i<t[s].length;i++)if(0<(this.target_type&1<<i)&&0<t[s][i]){e=!0;break}}return e},t}(),UserPetitIdol=function(){function o(){this.type="0",this.vocal="0",this.dance="0",this.visual="0",this.status=0,ko.track(this)}return o.prototype.display_status=function(){return Math.ceil(this.status)},o.prototype.calculation=function(t,e,s){void 0===t&&(t=0),void 0===e&&(e=-1),void 0===s&&(s=-1);for(var i=parseInt(this.type),a=this.get_parameters(),_=0,l=0;l<a.length;l++)l==s&&(a[l]+=Math.ceil(a[l]*o.PARAMETER_BONUS_COEFFICIENT)),_+=a[l];i==e&&(_+=Math.ceil(_*o.TYPE_BONUS_COEFFICIENT)),_+=_*t/100,this.status=_},o.prototype.calculation_festival=function(t){var e=0;t&&(e=100*o.HIGH_TENSION_BONUS_COEFFICIENT),this.calculation(e)},o.prototype.calculation_live_royal=function(t,e,s,i){this.calculation(0,t,e);var a=this.status;a=Math.ceil(a*i),a*=s,this.status=a},o.prototype.get_parameters=function(){var t=[];t.push(parseInt(this.vocal)),t.push(parseInt(this.dance)),t.push(parseInt(this.visual));for(var e=0;e<t.length;e++)isNaN(t[e])&&(t[e]=0);return t},o.prototype.get_setting=function(){var t={};return t.type=this.type,t.vocal=this.vocal,t.dance=this.dance,t.visual=this.visual,t},o.prototype.set_setting=function(t){this.type=t.type,this.vocal=t.vocal,this.dance=t.dance,this.visual=t.visual},o.TYPE_BONUS_COEFFICIENT=.2,o.PARAMETER_BONUS_COEFFICIENT=.5,o.HIGH_TENSION_BONUS_COEFFICIENT=.1,o}();!function(t){t[t.NORMAL=0]="NORMAL",t[t.SURVIVAL=1]="SURVIVAL",t[t.FESTIVAL=2]="FESTIVAL",t[t.LIVE_TOUR=3]="LIVE_TOUR",t[t.SESSION=4]="SESSION",t[t.DREAM_LIVE_FESTIVAL=5]="DREAM_LIVE_FESTIVAL",t[t.ROYAL=6]="ROYAL",t[t.ROYAL_GUEST=7]="ROYAL_GUEST",t[t.TALK_BATTLE=8]="TALK_BATTLE",t[t.CHALLENGE=9]="CHALLENGE",t[t.FESTIVAL_S=10]="FESTIVAL_S"}(CALCULATION_TYPE=CALCULATION_TYPE||{}),function(t){t[t.MANUAL=0]="MANUAL",t[t.AUTO=1]="AUTO",t[t.AUTO_MEAN=2]="AUTO_MEAN"}(SKILL_INPUT_MODE=SKILL_INPUT_MODE||{}),function(t){t[t.ALL=0]="ALL",t[t.OFFENSE=1]="OFFENSE",t[t.DEFENSE=2]="DEFENSE"}(ENABLE_SKILL_TYPE=ENABLE_SKILL_TYPE||{});var BaseLiveCalcViewModel=function(){function i(){var e=this;this.calc_type=CALCULATION_TYPE.NORMAL.toString(),this.front_num="0",this.producer_type="-1",this.appeal_bonus=["0","0","0"],this.training_room_level="0",this.idol_list=[],this.petit_idol_list=[],this.skill_input_type="0",this.enable_skill_type="0",this.rival_front_num=["0","0","0"],this.rival_back_num=["0","0","0"],this.petit_idol_total_status=0,this.max_skill_invoke=0,this.skill_invocation_rate_list=[],this.save_data_key="",this.save_data_id="1",this.save_data_title="",this.code="",this.apply_code_url="",this.move_up=function(){var t=e.idol_list.indexOf(this);0<t&&e.idol_list.splice(t-1,2,e.idol_list[t],e.idol_list[t-1])},this.move_down=function(){var t=e.idol_list.indexOf(this);t<e.idol_list.length-1&&e.idol_list.splice(t,2,e.idol_list[t+1],e.idol_list[t])}}return i.prototype.actual_status=function(){return[0,0]},i.prototype.change_appeal_bonus=function(){ko.valueHasMutated(this,"appeal_bonus")},i.prototype.change_rival_front_num=function(){ko.valueHasMutated(this,"rival_front_num")},i.prototype.change_rival_back_num=function(){ko.valueHasMutated(this,"rival_back_num")},i.prototype.init_list=function(){this.init_idol_list(),this.init_petit_idol_list();var t=Common.get_param_list();t.code&&(this.code=t.code,this.apply_code())},i.prototype.init_idol_list=function(){},i.prototype.init_petit_idol_list=function(){for(var t=[],e=0;e<i.PETIT_IDOL_NUM;e++){var s=new UserPetitIdol;t.push(s)}this.petit_idol_list=t},i.prototype.calculation_petit_idol=function(t,e,s){void 0===t&&(t=0),void 0===e&&(e=-1),void 0===s&&(s=-1);for(var i=0,a=0;a<this.petit_idol_list.length;a++){var _=this.petit_idol_list[a];_.calculation(t,e,s),i+=_.status}return i},i.prototype.is_smartphone=function(){return Common.is_smartphone()},i.prototype.get_setting=function(){return{}},i.prototype.set_setting=function(t){},i.prototype.get_idol_setting=function(){for(var t=[],e=0;e<this.idol_list.length;e++)t.push(this.idol_list[e].get_setting());return t},i.prototype.set_idol_setting=function(i,a){var _=this;void 0===a&&(a=-1);for(var l=jQuery.Deferred(),t={},e=0;e<i.length;e++){var s="t"+i[e].type+"_r"+i[e].rarity;s in t||(t[s]={type:i[e].type,rarity:i[e].rarity})}var o=Object.keys(t),r=[];for(e=0;e<o.length;e++){var n=t[o[e]];r.push(Common.load_idol_list(parseInt(n.type),parseInt(n.rarity)))}return-1==a&&(a=i.length),jQuery.when.apply(null,r).done(function(){for(var t=[],e=0;e<i.length&&e<a;e++){(s=new UserIdol).set_setting(i[e]),t.push(s)}for(e=t.length;e<a;e++){var s=new UserIdol;t.push(s)}_.idol_list=t,l.resolve()}),l.promise()},i.prototype.get_appeal_bonus_setting=function(){for(var t=[],e=0;e<this.appeal_bonus.length;e++){var s={};s.type=e.toString(),s.value=this.appeal_bonus[e],t.push(s)}return t},i.prototype.set_appeal_bonus_setting=function(t){if(null!=t){for(var e=this.appeal_bonus,s=0;s<t.length;s++)if(null!=t[s]){var i=t[s];e[i.type]=i.value.toString()}this.appeal_bonus=e,this.change_appeal_bonus()}},i.prototype.get_rival_member_setting=function(){for(var t={front:[]},e=0;e<this.rival_front_num.length;e++){(s={}).type=e.toString(),s.value=this.rival_front_num[e],t.front.push(s)}t.back=[];for(e=0;e<this.rival_back_num.length;e++){var s;(s={}).type=e.toString(),s.value=this.rival_back_num[e],t.back.push(s)}return t},i.prototype.set_rival_member_setting=function(t){if(null!=t){if(null!=t.front){for(var e=this.rival_front_num,s=0;s<t.front.length;s++){if(null!=t.front[s])e[(a=t.front[s]).type]=a.value.toString()}this.rival_front_num=e,this.change_rival_front_num()}if(null!=t.back){var i=this.rival_back_num;for(s=0;s<t.back.length;s++){var a;if(null!=t.back[s])i[(a=t.back[s]).type]=a.value.toString()}this.rival_back_num=i,this.change_rival_back_num()}}},i.prototype.get_petit_idol_setting=function(){for(var t=[],e=0;e<this.petit_idol_list.length;e++)t.push(this.petit_idol_list[e].get_setting());return t},i.prototype.set_petit_idol_setting=function(t,e){if(null!=t){for(var s=[],i=0;i<t.length&&i!=e;i++){var a=new UserPetitIdol;a.set_setting(t[i]),s.push(a)}this.petit_idol_list=s}},i.prototype.save_setting=function(){try{var t=this.save_data_key+"_title_"+this.save_data_id;localStorage.setItem(t,this.save_data_title),t=this.save_data_key+"_"+this.save_data_id,localStorage.setItem(t,JSON.stringify(this.get_setting()))}catch(t){console.log(t.message),alert("データ保存時にエラーが発生しました。")}},i.prototype.load_setting=function(){var t=this.save_data_key+"_title_"+this.save_data_id,e=localStorage.getItem(t);t=this.save_data_key+"_"+this.save_data_id;var s=localStorage.getItem(t);if(null!=s){null==e&&(e="");var i=JSON.parse(s);this.save_data_title=e,this.set_setting(i)}else alert("データが保存されていません。")},i.prototype.generate_code=function(){var t=this.get_setting(),e=JSON.stringify(t);try{var s=Common.get_compress_data(e),i=Common.get_page_url()+"?code="+s;this.code=s,this.apply_code_url=i}catch(t){console.log(t.message),alert("コードの生成に失敗しました。")}},i.prototype.apply_code=function(){try{var t=Common.get_decompress_data(this.code),e=JSON.parse(t),s=Common.get_page_url()+"?code="+this.code;this.set_setting(e),this.apply_code_url=s}catch(t){console.log(t.message),alert("コードの適用に失敗しました。")}},i.prototype.is_skill_input_type_manual=function(){return parseInt(this.skill_input_type)==SKILL_INPUT_MODE.MANUAL},i.prototype.calc_skill_value=function(){var a=this;if(!this.is_skill_input_type_manual()){for(var t=0;t<this.idol_list.length;t++){var e=this.idol_list[t];e.offense_skill="0",e.defense_skill="0",e.enable_skill=!1}this.get_invoke_skill_list().done(function(t){for(var e=parseInt(a.front_num),s=0;s<a.idol_list.length;s++){var i=s<e;a.apply_skill_effect(a.idol_list[s],i,t)}})}},i.prototype.get_invoke_skill_list=function(){for(var l=this,o=parseInt(this.front_num),r=[[0,0,0],[0,0,0]],t=0;t<this.idol_list.length;t++){var e=parseInt(this.idol_list[t].type);t<o?r[0][e]++:r[1][e]++}var n=[[0,0,0],[0,0,0]];for(t=0;t<this.rival_front_num.length;t++)n[0][t]=parseInt(this.rival_front_num[t]);for(t=0;t<this.rival_back_num.length;t++)n[1][t]=parseInt(this.rival_back_num[t]);var c=jQuery.Deferred();return Common.load_skill_list().done(function(t){for(var e=[],s=parseInt(l.skill_input_type),i=0;i<l.idol_list.length&&i<o;i++){var a=l.idol_list[i],_=l.get_invoke_skill(a,t,r,n,e.length);if(null!=_&&(e.push(_),s!=SKILL_INPUT_MODE.AUTO_MEAN&&e.length>=l.max_skill_invoke))break}c.resolve(e)}),c.promise()},i.prototype.get_invoke_skill=function(t,e,s,i,a){if(0==parseInt(t.skill_id)||0==parseInt(t.skill_level))return null;var _=this.get_skill(t,e);return null==_?null:this.check_skill_enable(_,s,i)?(t.enable_skill=!0,this.correct_skill_value(_,a),_.target_member==SKILL_TARGET_MEMBER.SELF&&this.apply_skill_value(t,_),_):null},i.prototype.get_skill=function(t,e){var s=jQuery.extend(!0,{},e[t.skill_id]);return null==s.skill_value_list||0==s.skill_value_list.length?null:new Skill(s,parseInt(t.skill_level))},i.prototype.check_skill_enable=function(t,e,s){return t.target_unit==SKILL_TARGET_UNIT.OWN?this.check_target_own_unit_skill_enable(t,e):this.check_target_rival_unit_skill_enable(t,s)},i.prototype.check_target_own_unit_skill_enable=function(t,e){var s=parseInt(this.enable_skill_type);return(s==ENABLE_SKILL_TYPE.ALL||t.target_param==SKILL_TARGET_PARAM.ALL||s==t.target_param)&&(t.target_member==SKILL_TARGET_MEMBER.SELF||t.check_skill_target(e))},i.prototype.check_target_rival_unit_skill_enable=function(t,e){var s=parseInt(this.enable_skill_type);return s==ENABLE_SKILL_TYPE.ALL||0<(s^t.target_param)},i.prototype.correct_skill_value=function(t,e){if(parseInt(this.skill_input_type)==SKILL_INPUT_MODE.AUTO_MEAN){var s=this.skill_invocation_rate_list[e];null!=s&&(t.value*=s/100)}},i.prototype.apply_skill_effect=function(t,e,s){for(var i=0;i<s.length;i++){var a=s[i];if(this.check_apply_skill(t,a))switch(a.target_member){case SKILL_TARGET_MEMBER.SELF:break;case SKILL_TARGET_MEMBER.FRONT:e&&this.apply_skill_value(t,a);break;case SKILL_TARGET_MEMBER.BACK:!e&&(-1==a.target_num||0<a.target_num)&&(this.apply_skill_value(t,a),a.target_num--);break;case SKILL_TARGET_MEMBER.ALL:e?this.apply_skill_value(t,a):(-1==a.target_num||0<a.target_num)&&(this.apply_skill_value(t,a),a.target_num--)}}},i.prototype.apply_skill_value=function(t,e){var s=parseFloat(t.offense_skill),i=parseFloat(t.defense_skill);switch(e.target_param){case SKILL_TARGET_PARAM.ALL:s+=e.value,i+=e.value;break;case SKILL_TARGET_PARAM.OFFENSE:s+=e.value;break;case SKILL_TARGET_PARAM.DEFENSE:i+=e.value}t.offense_skill=s.toString(),t.defense_skill=i.toString()},i.prototype.check_apply_skill=function(t,e){var s=!1,i=parseInt(t.type);return e.target_unit==SKILL_TARGET_UNIT.OWN&&(e.target_member==SKILL_TARGET_MEMBER.SELF||0<(e.target_type&1<<i))&&(s=!0),s},i.PETIT_IDOL_NUM=3,i}(),__extends=this&&this.__extends||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);function i(){this.constructor=t}t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ViewModel=function(t){function e(){t.call(this),this.calc_type=CALCULATION_TYPE.SESSION.toString(),this.total_cost="0",this.use_cost_percent="100",this.front_num="5",this.auto_sort=!1,this.sort_type="0",this.add_idol=new UserIdol,this.add_idol_num="1",this.front_offense=0,this.front_defense=0,this.back_offense=0,this.back_defense=0,this.save_data_key="imas_cg_live_calc";var e=this;e.add=function(){var t=e.idol_list.indexOf(this);e.idol_list.splice(t+1,0,new UserIdol)},e.remove=function(){1<e.idol_list.length&&e.idol_list.remove(this)},this.init_list(),ko.track(this)}return __extends(e,t),e.prototype.actual_status=function(){return this.calculation()},e.prototype.init_idol_list=function(){var t=[];t.push(new UserIdol),this.idol_list=t},e.prototype.calculation=function(){this.sort_idol(),this.calc_skill_value();for(var t=parseInt(this.producer_type),e=0<parseInt(this.total_cost),s=parseInt(this.use_cost_percent)/100,i=Math.floor(parseInt(this.total_cost)*s),a=0,_=0,l=0,o=0,r=0,n=0,c=0;c<this.idol_list.length;c++){var h=this.idol_list[c],p=c<parseInt(this.front_num);h.calculation_live_trial(e,i,p,t);var u=h.actual_offense,f=h.actual_defense;p?(l+=u,o+=f):(r+=u,n+=f),a+=u,_+=f;var d="numeric "+(p?"front":"back");e&&i<h.get_cost()&&(d+=" cost_over"),h.style=d,(i-=h.get_cost())<0&&(i=0)}return this.front_offense=Math.round(l),this.front_defense=Math.round(o),this.back_offense=Math.round(r),this.back_defense=Math.round(n),[Math.ceil(a),Math.ceil(_)]},e.prototype.sort_idol=function(){if(this.auto_sort){var t=parseInt(this.front_num),e=this.idol_list.slice(0,t),s=this.idol_list.slice(t);s.sort(function(t,e){var s=0,i=t.offense_per_cost(),a=parseInt(t.offense),_=e.offense_per_cost(),l=parseInt(e.offense);return i!=_?s=i<_?1:-1:a!=l&&(s=a<l?1:-1),s}),this.idol_list=e.concat(s)}},e.prototype.add_idols=function(){for(var t=this.add_idol.get_setting(),e=parseInt(this.add_idol_num),s=this.idol_list,i=0;i<e;i++){var a=new UserIdol;a.set_setting(t),s.push(a)}ko.valueHasMutated(this,"idol_list")},e.prototype.get_setting=function(){var t={};return t.user_cost=this.total_cost,t.use_cost_percent=this.use_cost_percent,t.front_num=this.front_num,t.producer_type=this.producer_type,t.skill_input_type=this.skill_input_type,t.enable_skill_type=this.enable_skill_type,t.idol=this.get_idol_setting(),t},e.prototype.set_setting=function(t){this.total_cost=t.user_cost,this.use_cost_percent=t.use_cost_percent,this.front_num=t.front_num,this.producer_type=t.producer_type,this.calc_type=t.calc_type,this.enable_skill_type=t.enable_skill_type,this.set_idol_setting(t.idol)},e}(BaseLiveCalcViewModel);jQuery(function(){ko.applyBindings(new ViewModel)});